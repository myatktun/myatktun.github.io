
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Linux &#8212; Notes</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Linux';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Machine Learning" href="MachineLearning.html" />
    <link rel="prev" title="LangChain" href="LangChain.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Notes</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="AITools.html">AI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="AWS.html">AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="ArmArchitecture.html">Arm Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="Assembly.html">Assembly</a></li>
<li class="toctree-l1"><a class="reference internal" href="BackendEngineering.html">Backend Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="C.html">C</a></li>
<li class="toctree-l1"><a class="reference internal" href="C%2B%2B.html">C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="CSharp.html">C# #</a></li>
<li class="toctree-l1"><a class="reference internal" href="CTF.html">CTF</a></li>
<li class="toctree-l1"><a class="reference internal" href="CompTIA.html">CompTIA Cert Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Compilers.html">Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ComputerGraphics.html">Computer Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="ComputerVision.html">Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="ComputingSystems.html">Computing Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="CyberSecurity.html">Cyber Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="DataStructure%26Algorithms.html">Data Structure &amp; Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="DatabaseEngineering.html">Database Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="DeepLearning.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="DesignPatterns.html">Design Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="Docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="ECS.html">ECS</a></li>
<li class="toctree-l1"><a class="reference internal" href="FFmpeg.html">FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="Git.html">Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="Helm.html">Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="Istio.html">Istio</a></li>
<li class="toctree-l1"><a class="reference internal" href="JDBC.html">JDBC</a></li>
<li class="toctree-l1"><a class="reference internal" href="Java.html">Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="Jenkins.html">Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="Kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="LangChain.html">LangChain</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Microservices.html">Microservices</a></li>
<li class="toctree-l1"><a class="reference internal" href="MongoDB.html">MongoDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="NetworkProgramming.html">Network Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="NodeJS.html">Node.js</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenAPI.html">OpenAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="OperatingSystem.html">Operating System</a></li>
<li class="toctree-l1"><a class="reference internal" href="POSIXThreads.html">POSIX Threads</a></li>
<li class="toctree-l1"><a class="reference internal" href="PenetrationTesting.html">Penetration Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ProgramDesign.html">Program Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="ProjectManagement.html">Project Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="Prometheus.html">Prometheus</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="React.html">React</a></li>
<li class="toctree-l1"><a class="reference internal" href="Redis.html">Redis</a></li>
<li class="toctree-l1"><a class="reference internal" href="SFML.html">SFML</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQL.html">SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="StrategicPlanning.html">Strategic Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Terraform.html">Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="TypeScript.html">TypeScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="UIUX.html">UI/UX</a></li>
<li class="toctree-l1"><a class="reference internal" href="Vagrant.html">Vagrant</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Linux.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Linux</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#commands">Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#file-directory">File &amp; Directory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#links">Links</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-find">Search &amp; Find</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#input-output">Input/Output</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#processes">Processes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#man">Man</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reboot-shutdown">Reboot &amp; Shutdown</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boot-targets">Boot Targets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootloader">Bootloader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#init-systems">Init Systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#schedule-jobs">Schedule Jobs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#package-manager">Package Manager</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bash-scripts">Bash Scripts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selinux">SELinux</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-runtime-parameters">Kernel Runtime Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#users">Users</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#groups">Groups</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-variables">Environment Variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resource-limits">Resource Limits</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#privileges">Privileges</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acls">ACLs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#network-management">Network Management</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#firewall">Firewall</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#static-routing">Static Routing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-synchronisation">Time Synchronisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bind">Bind</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#email">Email</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ssh">SSH</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#http">HTTP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#database-server">Database Server</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#devices-disks">Devices &amp; Disks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-file-systems">Creating File Systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lvm">LVM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#device-encryption">Device Encryption</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raid">RAID</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-management">Memory Management</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#virtual-memory">Virtual Memory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-management-unit">Memory Management Unit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-virtual-memory">Kernel Virtual Memory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-logical-addresses">Kernel Logical Addresses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-virtual-addresses">Kernel Virtual Addresses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#user-virtual-addresses">User Virtual Addresses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#user-space-allocation">User-Space Allocation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-development">Kernel Development</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-tools">Build Tools</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-dependent-tools">Kernel Dependent Tools</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-config">Kernel Config</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-kernel">Build Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#install-kernel">Install Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade-kernel">Upgrade Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customise-kernel">Customise Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-drivers">Find Drivers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#common-config">Common Config</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#code-navigation">Code Navigation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pie">PIE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ffi">FFI</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-data-structures">Kernel Data Structures</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#file-operations">File Operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inode">Inode</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-modules">Kernel Modules</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-role">Kernel Role</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#device-and-module-classes">Device and Module Classes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#protection-levels">Protection Levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#current-process">Current Process</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compile-and-load-modules">Compile and Load Modules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-stacking">Module Stacking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-conventions">Module Conventions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-functions">Module Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-parameters">Module Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pam">PAM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#device-drivers">Device Drivers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#driver-components">Driver Components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#user-space-drivers">User-Space Drivers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scull-driver">scull Driver</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#udev">Udev</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linux-from-scratch">Linux From Scratch</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-preparations">LFS Preparations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-building">LFS Building</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-directories">LFS Directories</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-backup-and-restore">LFS Backup and Restore</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-debugging-symbols">LFS Debugging Symbols</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-udev-issues">LFS Udev Issues</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-external-resources">References &amp; External Resources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="linux">
<h1>Linux<a class="headerlink" href="#linux" title="Link to this heading">#</a></h1>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#commands">Commands</a></p></li>
<li><p><a class="reference internal" href="#memory-management">Memory Management</a></p></li>
<li><p><a class="reference internal" href="#kernel-development">Kernel Development</a></p></li>
<li><p><a class="reference internal" href="#kernel-data-structures">Kernel Data Structures</a></p></li>
<li><p><a class="reference internal" href="#kernel-modules">Kernel Modules</a></p></li>
<li><p><a class="reference internal" href="#device-drivers">Device Drivers</a></p></li>
<li><p><a class="reference internal" href="#linux-from-scratch">Linux From Scratch</a></p></li>
<li><p><a class="reference internal" href="#references-external-resources">References &amp; External Resources</a></p></li>
</ol>
<p><a class="reference external" href="#linux">back to top</a></p>
<section id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#file-directory">File &amp; Directory</a>, <a class="reference internal" href="#links">Links</a>, <a class="reference internal" href="#search-find">Search &amp; Find</a>, <a class="reference internal" href="#input-output">Input/Output</a>, <a class="reference internal" href="#processes">Processes</a>, <a class="reference internal" href="#logging">Logging</a></p></li>
<li><p><a class="reference internal" href="#man">Man</a>, <a class="reference internal" href="#reboot-shutdown">Reboot &amp; Shutdown</a>, <a class="reference internal" href="#boot-targets">Boot Targets</a>, <a class="reference internal" href="#bootloader">Bootloader</a>, <a class="reference internal" href="#init-systems">Init Systems</a>, <a class="reference internal" href="#schedule-jobs">Schedule Jobs</a></p></li>
<li><p><a class="reference internal" href="#package-manager">Package Manager</a>, <a class="reference internal" href="#bash-scripts">Bash Scripts</a>, <a class="reference internal" href="#selinux">SELinux</a>, <a class="reference internal" href="#kernel-runtime-parameters">Kernel Runtime Parameters</a></p></li>
<li><p><a class="reference internal" href="#users">Users</a>, <a class="reference internal" href="#groups">Groups</a>, <a class="reference internal" href="#environment-variables">Environment Variables</a>, <a class="reference internal" href="#resource-limits">Resource Limits</a>, <a class="reference internal" href="#privileges">Privileges</a>, <a class="reference internal" href="#acls">ACLs</a></p></li>
<li><p><a class="reference internal" href="#network-management">Network Management</a>, <a class="reference internal" href="#firewall">Firewall</a>, <a class="reference internal" href="#static-routing">Static Routing</a>, <a class="reference internal" href="#time-synchronisation">Time Synchronisation</a>, <a class="reference internal" href="#bind">Bind</a></p></li>
<li><p><a class="reference internal" href="#email">Email</a>, <a class="reference internal" href="#ssh">SSH</a>, <a class="reference internal" href="#http">HTTP</a>, <a class="reference internal" href="#database-server">Database Server</a></p></li>
<li><p><a class="reference internal" href="#devices-disks">Devices &amp; Disks</a>, <a class="reference internal" href="#creating-file-systems">Creating File Systems</a>, <a class="reference internal" href="#lvm">LVM</a>, <a class="reference internal" href="#device-encryption">Device Encryption</a>, <a class="reference internal" href="#raid">RAID</a></p></li>
</ul>
<section id="file-directory">
<h3>File &amp; Directory<a class="headerlink" href="#file-directory" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-la</span></code>: list all files &amp; dirs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pwd</span></code>: print working dir</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cd</span></code>: change dir</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mkdir</span></code>: make new dir</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">SOURCE</span> <span class="pre">DESTINATION</span></code>: copy files &amp; dirs (with <code class="docutils literal notranslate"><span class="pre">-r</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mv</span> <span class="pre">SOURCE</span> <span class="pre">DESTINATION</span></code>: move files &amp; dirs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rm</span></code>: delete files &amp; dirs (with <code class="docutils literal notranslate"><span class="pre">-r</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stat</span></code>: show file system status</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chgrp</span> <span class="pre">GP</span> <span class="pre">FILE</span></code>: change group of file &amp; dir</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chown</span></code>: change owner of file &amp; dir, requires root <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">user1:gp1</span> <span class="pre">FILE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-sh</span> <span class="pre">/</span></code>: check size of directory</p></li>
<li><p>most VMs require files to be less than 20GB</p></li>
<li><dl class="simple">
<dt><strong>chmod</strong></dt><dd><ul>
<li><p>change permissions of files &amp; dirs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">6640</span></code>: 4=r &amp; SUID, 2=w &amp; GID, 1=x &amp; sticky, 0=- (can also use binary values)</p></li>
<li><p>permissions are checked linearly</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">u+rwx,g-x,o=r</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rws</span></code>: enabling SUID/GID causes file to be executed as the owner</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rwS</span></code>: SUID/GID set but not executable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rwt</span></code> or <code class="docutils literal notranslate"><span class="pre">rwT</span></code>: sticky bits are usually set on shared directories and allow the
owner to remove the file no matter the permissions of the directory</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>modified time: create or edit, change time: change metadata</p></li>
<li><dl class="simple">
<dt><strong>View File Content</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cat</span></code>, <code class="docutils literal notranslate"><span class="pre">tac</span></code> (reverse)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tail</span></code>, <code class="docutils literal notranslate"><span class="pre">head</span></code> (<code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">10</span></code> for only 10 lines, <code class="docutils literal notranslate"><span class="pre">-F</span></code> for follow)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">less</span></code>, <code class="docutils literal notranslate"><span class="pre">more</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Edit File Content</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sed</span> <span class="pre">-i</span> <span class="pre">'s/SEARCH/REPLACE/g'</span> <span class="pre">FILE</span></code>: stream editor</p></li>
<li><p>replace only first without <code class="docutils literal notranslate"><span class="pre">g</span></code>, show only preview without <code class="docutils literal notranslate"><span class="pre">-i</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span> <span class="pre">-d</span> <span class="pre">':'</span> <span class="pre">-f</span> <span class="pre">2</span> <span class="pre">FILE</span></code>: extract file content</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">FILE</span></code>: sort content</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uniq</span> <span class="pre">FILE</span></code>: remove adjacent duplicates (better use with <code class="docutils literal notranslate"><span class="pre">sort</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">diff</span> <span class="pre">-c</span> <span class="pre">FILE1</span> <span class="pre">FILE2</span></code>: show differences, use <code class="docutils literal notranslate"><span class="pre">sdiff</span></code> or <code class="docutils literal notranslate"><span class="pre">diff</span> <span class="pre">-y</span></code> to show side by side</p></li>
<li><dl class="simple">
<dt><strong>Rsync</strong></dt><dd><ul>
<li><p>remote synchronization, syncing to remote server need SSH daemon</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rsync</span> <span class="pre">-a</span> <span class="pre">SOURCE/</span> <span class="pre">TARGET/</span></code>: sync two directories</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>File Compression</strong></dt><dd><ul>
<li><p>compress: <code class="docutils literal notranslate"><span class="pre">gzip</span> <span class="pre">FILE</span></code>, <code class="docutils literal notranslate"><span class="pre">bzip2</span></code>, <code class="docutils literal notranslate"><span class="pre">xz</span></code>, <code class="docutils literal notranslate"><span class="pre">zip</span> <span class="pre">FILE.zip</span> <span class="pre">FILE</span></code></p></li>
<li><p>decompress: <code class="docutils literal notranslate"><span class="pre">gunzip</span> <span class="pre">FILE.gz</span></code>, <code class="docutils literal notranslate"><span class="pre">bunzip</span></code>, <code class="docutils literal notranslate"><span class="pre">unxz</span></code>, <code class="docutils literal notranslate"><span class="pre">unzip</span> <span class="pre">FILE.zip</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-k</span></code> or <code class="docutils literal notranslate"><span class="pre">--keep</span></code>, keep input files (delete by default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-l</span></code> or <code class="docutils literal notranslate"><span class="pre">--list</span></code>, list contents</p></li>
<li><p>can also use <code class="docutils literal notranslate"><span class="pre">less</span></code> to list contents</p></li>
<li><p>only <code class="docutils literal notranslate"><span class="pre">zip</span> <span class="pre">-r</span></code> can compress multiple files or directories, others need to use <code class="docutils literal notranslate"><span class="pre">tar</span></code>
first</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Tar</strong></dt><dd><ul>
<li><p>tape archive, archive files into one tarball</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">f</span> <span class="pre">FILE</span></code>: same as <code class="docutils literal notranslate"><span class="pre">--file</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">tf</span> <span class="pre">FILE.tar</span></code>: list contents from tar</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">cf</span> <span class="pre">FILE.tar</span> <span class="pre">FILE</span></code>: create tar</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">rf</span></code>: append/add to existing tar</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">xf</span></code>: extract (<code class="docutils literal notranslate"><span class="pre">xf</span> <span class="pre">FILE.tar</span> <span class="pre">-C</span> <span class="pre">DIR</span></code>, extract to ‘DIR’)</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">sudo</span></code> to preserve permissions</p></li>
<li><p>archive and compress same time: <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">czf</span> <span class="pre">FILE.tar.gz</span> <span class="pre">FILE</span></code>,
<code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">cjf</span> <span class="pre">FILE.tar.bz2</span> <span class="pre">FILE</span></code>, <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">cJf</span> <span class="pre">FILE.tar.xz</span> <span class="pre">FILE</span></code></p></li>
<li><p>auto detect and compress: <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">caf</span> <span class="pre">FILE.tar.gz/bz2/xz</span> <span class="pre">FILE</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Attributes</strong></dt><dd><ul>
<li><p>can make file or directory behave differently</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chattr</span> <span class="pre">+a</span> <span class="pre">FILE</span></code>: can only append</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chattr</span> <span class="pre">-a</span> <span class="pre">FILE</span></code>: remove append only attribute</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chattr</span> <span class="pre">+i</span> <span class="pre">FILE</span></code>: file is immutable, even root user cannot modify</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lsattr</span> <span class="pre">FILE</span></code>: list attributes of file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">chattr</span></code>: list all available attributes</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="links">
<h3>Links<a class="headerlink" href="#links" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>Hard Links</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">TARGET_PATH</span> <span class="pre">LINK_PATH</span></code>: points to the same inode</p></li>
<li><p>if multiple hard links exist, deleting one will not delete the other</p></li>
<li><p>can only hard link to files on the same fs</p></li>
<li><p>need proper permissions to create and access</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Soft Links</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">TARGET_PATH</span> <span class="pre">LINK_PATH</span></code>, points to a path of the file or dir like shortcut</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">readlink</span></code>: show full path of soft link</p></li>
<li><p>permissions only depend on the target</p></li>
<li><p>changing the target will break the link</p></li>
<li><p>can also create soft links with relative path</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="search-find">
<h3>Search &amp; Find<a class="headerlink" href="#search-find" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>Find</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">find</span></code>: find files &amp; dirs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-mmin</span></code>: modified minute</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-mtime</span></code>: modified days</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-size</span></code>: -512k or +512k (c, k, M, G)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-perm</span> <span class="pre">644</span></code> (exact): <code class="docutils literal notranslate"><span class="pre">-644</span></code> (at least 644), <code class="docutils literal notranslate"><span class="pre">/644</span></code> (any of these)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-name</span> <span class="pre">-o</span> <span class="pre">-size</span></code>: OR</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-not</span></code> or <code class="docutils literal notranslate"><span class="pre">\!</span></code>: NOT</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">.</span> <span class="pre">-perm</span> <span class="pre">/4000</span></code>: find files with SUID set with any permissions</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Grep</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grep</span></code>: search text</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span></code>: ignore case</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span></code>: recursive through all files in a dir</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-v</span></code>: invert match</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-w</span></code>: only words</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span></code>: output only matching</p></li>
<li><p>use basic regular expressions, meta-characters lose special meaning, need to be
escaped</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">egrep</span></code> or <code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-E</span></code>: use extended regular expressions, meta-characters do not need
to be escaped</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Regular Expressions</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">^</span></code>: starts with, <code class="docutils literal notranslate"><span class="pre">$</span></code>: ends with</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.</span></code>: match any 1 character, <code class="docutils literal notranslate"><span class="pre">\</span></code>: escape character</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code>: match previous 0 or more times, <code class="docutils literal notranslate"><span class="pre">+</span></code>: match previous 1 or more times</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{X}</span></code>: previous can exist X times (<code class="docutils literal notranslate"><span class="pre">{MIN,MAX}</span></code>), <code class="docutils literal notranslate"><span class="pre">?</span></code>: previous can be optional</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code>: match one or other, <code class="docutils literal notranslate"><span class="pre">()</span></code>: sub-expressions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[]</span></code>: range (<code class="docutils literal notranslate"><span class="pre">[a-z]</span></code>) or sets (<code class="docutils literal notranslate"><span class="pre">[abc123]</span></code>), <code class="docutils literal notranslate"><span class="pre">[^]</span></code>: negated range or sets</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="input-output">
<h3>Input/Output<a class="headerlink" href="#input-output" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;</span></code>: stdin (0), <code class="docutils literal notranslate"><span class="pre">1&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>: stdout, <code class="docutils literal notranslate"><span class="pre">2&gt;</span></code>: stderr</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>: append</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">FILE.txt</span> <span class="pre">2&gt;&amp;1</span></code> or <code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">FILE.txt</span> <span class="pre">&gt;&amp;</span></code>: both stdout and stderr</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;&lt;EOF</span> <span class="pre">...any</span> <span class="pre">text</span> <span class="pre">here...</span> <span class="pre">&gt;</span> <span class="pre">EOF</span></code>: heredoc</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;&lt;&lt;</span> <span class="pre">string</span></code>: here string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">command1</span> <span class="pre">|</span> <span class="pre">command2</span></code>: pipe ‘COMMAND1’ output to ‘COMMAND2’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">column</span></code>: arrange columns</p></li>
</ul>
</div></blockquote>
</section>
<section id="processes">
<h3>Processes<a class="headerlink" href="#processes" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">top</span></code>: list processes in real time, order by cpu usage</p></li>
<li><dl class="simple">
<dt><strong>ps</strong></dt><dd><ul>
<li><p>list processes at the time the command is run</p></li>
<li><p>only show current processes in session by default</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">-aux</span></code> for Unix style, and <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">aux</span></code> for BSD style</p></li>
<li><p>processes in ‘[]’ are kernel processes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">1</span></code>: list process by PID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">-U</span> <span class="pre">user</span></code>: list processes started by ‘user’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pgrep</span> <span class="pre">-a</span> <span class="pre">bash</span></code>: search process by name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">l</span></code>: include nice value column</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">fax</span></code>: list processes tree</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>nice</strong></dt><dd><ul>
<li><p>start process with specific nice value (-20 to 19), e.g. <code class="docutils literal notranslate"><span class="pre">nice</span> <span class="pre">-n</span> <span class="pre">9</span> <span class="pre">bash</span></code></p></li>
<li><p>processes inherit nice values</p></li>
<li><p>regular user can only assign values between 0 and 19</p></li>
<li><p>assigning negative nice value requires root</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">renice</span></code>: change process nice value, can only lower the value once as regular user</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>kill</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-SIGHUP</span> <span class="pre">PID</span></code>: send signal to process by name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">PID</span></code>: send <code class="docutils literal notranslate"><span class="pre">TERM</span></code> signal by default</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-L</span></code>: list signals list</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kill</span> <span class="pre">-9</span> <span class="pre">PID</span></code>: send signal by number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pkill</span> <span class="pre">-KILL</span> <span class="pre">bash</span></code>: kill processes that are bash</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTRL</span> <span class="pre">+</span> <span class="pre">c</span></code>: breaks the process</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTRL</span> <span class="pre">+</span> <span class="pre">z</span></code>: pause the process and sends it to background</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bg</span> <span class="pre">1</span></code>: run paused background process</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sleep</span> <span class="pre">100</span> <span class="pre">&amp;</span></code>: run process in background</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fg</span></code>: bring back background/paused process</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jobs</span></code>: list background/paused processes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lsof</span> <span class="pre">-p</span> <span class="pre">PID</span></code>: list files used by the process</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lsof</span> <span class="pre">/var/log/</span></code>: list which processes use the files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">free</span> <span class="pre">-h</span></code>: check memory usage</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uptime</span></code>: check cpu usage</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lscpu</span></code>: check cpu usage in detail</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lspci</span></code>: check other hardware usage</p></li>
</ul>
</div></blockquote>
</section>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>logging daemons collect, organize and store logs</p></li>
<li><dl class="simple">
<dt><strong>rsyslog</strong></dt><dd><ul>
<li><p>stores logs in <code class="docutils literal notranslate"><span class="pre">/var/log</span></code></p></li>
<li><p>rocket-fast system for log processing</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>journalctl</strong></dt><dd><ul>
<li><p>to read system logs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">$(which</span> <span class="pre">sudo)</span></code>: show logs generated by <code class="docutils literal notranslate"><span class="pre">sudo</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">-u</span> <span class="pre">sshd.service</span></code>: logs by service</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">-f</span></code>: follow mode</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">-p</span> <span class="pre">err</span></code>: show only error logs (<code class="docutils literal notranslate"><span class="pre">info</span></code>, <code class="docutils literal notranslate"><span class="pre">warning</span></code>, <code class="docutils literal notranslate"><span class="pre">err</span></code>, <code class="docutils literal notranslate"><span class="pre">crit</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">-g</span> <span class="pre">'^a'</span></code>: using with grep expressions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">-S</span> <span class="pre">02:00</span></code>: show only logs after 2am</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">-S</span> <span class="pre">02:00</span> <span class="pre">-U</span> <span class="pre">03:00</span></code>: show only logs between 2am and 3am</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">-S</span> <span class="pre">'1999-1-1</span> <span class="pre">12:00:59</span></code>: using dates</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">-b</span> <span class="pre">0</span></code>: current boot logs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">journalctl</span> <span class="pre">-b</span> <span class="pre">1</span></code>: previous boot logs (require <code class="docutils literal notranslate"><span class="pre">/var/log/journal</span></code>)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">last</span></code> and <code class="docutils literal notranslate"><span class="pre">lastlog</span></code> to show last login time</p></li>
</ul>
</div></blockquote>
</section>
<section id="man">
<h3>Man<a class="headerlink" href="#man" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">COMMAND</span></code>: manual pages of COMMAND</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mandb</span></code>: update manual pages</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apropos</span></code>: search commands</p></li>
</ul>
</div></blockquote>
</section>
<section id="reboot-shutdown">
<h3>Reboot &amp; Shutdown<a class="headerlink" href="#reboot-shutdown" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">reboot</span></code> or <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">reboot</span></code> and <code class="docutils literal notranslate"><span class="pre">shutdown</span></code> or <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">shutdown</span></code></p></li>
<li><p>both are links to <code class="docutils literal notranslate"><span class="pre">systemctl</span></code></p></li>
<li><p>can use <code class="docutils literal notranslate"><span class="pre">--force</span></code> or <code class="docutils literal notranslate"><span class="pre">--force</span> <span class="pre">--force</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shutdown</span> <span class="pre">13:00</span></code>: schedule shutdown at 1pm</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shutdown</span> <span class="pre">+20</span></code>: schedule shutdown in 20 minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shutdown</span> <span class="pre">-r</span> <span class="pre">+20</span></code>: schedule reboot in 20 minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shutdown</span> <span class="pre">-r</span> <span class="pre">+2</span> <span class="pre">'Show</span> <span class="pre">message</span> <span class="pre">to</span> <span class="pre">users'</span></code></p></li>
</ul>
</div></blockquote>
</section>
<section id="boot-targets">
<h3>Boot Targets<a class="headerlink" href="#boot-targets" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">graphical</span></code>, <code class="docutils literal notranslate"><span class="pre">multi-user</span></code>: text based, <code class="docutils literal notranslate"><span class="pre">emergency</span></code>: read-only root file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rescue</span></code>: more programs than <code class="docutils literal notranslate"><span class="pre">emergency</span></code>, but less than <code class="docutils literal notranslate"><span class="pre">multi-user</span></code></p></li>
<li><p>root user password must be set to use <code class="docutils literal notranslate"><span class="pre">emergency</span></code> and <code class="docutils literal notranslate"><span class="pre">rescue</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">get-default</span></code>: list boot target</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">set-default</span> <span class="pre">multi-user.target</span></code>: set new default boot target to be without GUI</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">isolate</span> <span class="pre">graphical.target</span></code>: change to GUI target without needing to reboot but
will not set default</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTRL</span> <span class="pre">+</span> <span class="pre">ALT</span> <span class="pre">+</span> <span class="pre">F3</span></code>: virtual terminals</p></li>
<li><dl class="simple">
<dt><strong>remote GUI login</strong></dt><dd><ul>
<li><p>can use VNC (Virtual Network Computing) server and client</p></li>
<li><p>allow RDP (Remote Desktop Protocol) for Windows user login</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="bootloader">
<h3>Bootloader<a class="headerlink" href="#bootloader" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>purpose is to start the Linux kernel, GRUB (Grand Unified Bootloader) is a popular one</p></li>
<li><dl class="simple">
<dt><strong>on BIOS</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grub2-mkconfig</span> <span class="pre">-o</span> <span class="pre">/boot/grub2/grub.cfg</span></code>: make config</p></li>
<li><p>bootloader should be installed on first section of the block device</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grub2-install</span> <span class="pre">/dev/sda</span></code>: install GRUB in first section</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>on EFI</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">grub2-mkconfig</span> <span class="pre">-o</span> <span class="pre">/boot/efi/EFI/fedora/grub.cfg</span></code>: make config on EFI</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">reinstall</span> <span class="pre">grub2-efi</span> <span class="pre">grub2-efi-modules</span> <span class="pre">shim</span></code>: auto place config file in right
location</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>edit the file <code class="docutils literal notranslate"><span class="pre">/etc/default/grub</span></code> and use above commands to update grub config</p></li>
</ul>
</div></blockquote>
</section>
<section id="init-systems">
<h3>Init Systems<a class="headerlink" href="#init-systems" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>initialisation system to start up the system as necessary</p></li>
<li><dl class="simple">
<dt><strong>Units</strong></dt><dd><ul>
<li><p>text files with instructions to start the system</p></li>
<li><p>can be service, socket, device, timer or others</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Service Units</strong></dt><dd><ul>
<li><p>what command to use to start a program</p></li>
<li><p>what to do when a program crashes and restarts</p></li>
<li><p>tell the <code class="docutils literal notranslate"><span class="pre">init</span></code> how to manage lifecycle of applications</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">systemd.service</span></code>: list instructions that can be added in services</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">edit</span> <span class="pre">--full</span> <span class="pre">sshd.service</span></code>: edit a service</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">revert</span> <span class="pre">sshd.service</span></code>: restore to default</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">sshd.service</span></code>: check service status</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">sshd.service</span></code>: start the service</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">stop</span> <span class="pre">sshd.service</span></code>: stop the service</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">sshd.service</span></code>: restart the service</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">reload</span> <span class="pre">sshd.service</span></code>: reload the service without closing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">reload-or-restart</span> <span class="pre">sshd.service</span></code>: use restart if reload is not supported</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">disable</span> <span class="pre">sshd.service</span></code>: do not start the service on startup</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">sshd.service</span></code>: start the service on startup</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">is-enabled</span> <span class="pre">sshd.service</span></code>: check if service will start on startup</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">--now</span> <span class="pre">sshd.service</span></code>: start the service on startup and start it now</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">disable</span> <span class="pre">--now</span> <span class="pre">sshd.service</span></code>: do no start the service on startup and stop
it now</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">mask</span> <span class="pre">atd.service</span></code>: do not allow the service to be started by others</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">unmask</span> <span class="pre">atd.service</span></code>: allow the service to be started by others</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">list-units</span> <span class="pre">--type</span> <span class="pre">service</span> <span class="pre">--all</span></code>: list all services available</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">list-dependencies</span></code>: check services running or not</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>System V</strong></dt><dd><ul>
<li><p>execute <code class="docutils literal notranslate"><span class="pre">init</span></code> that sets up basic processes and a script, <code class="docutils literal notranslate"><span class="pre">rc</span></code>, which controls the
execution of additional scripts</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">init</span></code> is controlled by <code class="docutils literal notranslate"><span class="pre">/etc/inittab</span></code></p></li>
<li><p>easy to customise, but slow to boot and does not directly support advanced features
like cgroups and per-user scheduling</p></li>
<li><p>has different run levels, 3 or 5 is default</p></li>
<li><p>0: halt, 1: single user mode, 2: user definable, 3: full multi-user mode</p></li>
<li><p>4: user definable, 5: full multi-user mode with display manager, 6: reboot</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="schedule-jobs">
<h3>Schedule Jobs<a class="headerlink" href="#schedule-jobs" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>anacron</strong></dt><dd><ul>
<li><p>schedule tasks specified in days</p></li>
<li><p>for machines that are not running 24 hours a day</p></li>
<li><p>can also schedule by editing <code class="docutils literal notranslate"><span class="pre">/etc/anacrontab</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anacron</span> <span class="pre">-T</span></code>: verify anacron syntax</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anacron</span> <span class="pre">-n</span></code>: run commands now</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>crontab</strong></dt><dd><ul>
<li><p>schedule tasks even in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">user</span> <span class="pre">command</span></code>: (minute, hour, day, month, day of week)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code> for all values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">,</span></code> for multiple values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code> for range of values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/</span></code> for specific steps</p></li>
<li><p>can omit <code class="docutils literal notranslate"><span class="pre">user</span></code></p></li>
<li><p>can also schedule by creating files in <code class="docutils literal notranslate"><span class="pre">/etc/cron.*</span></code> directories</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">etc/crontab</span></code>, systemwide cron</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>at</strong></dt><dd><ul>
<li><p>run command at specified time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">at</span> <span class="pre">03:00</span></code>, <code class="docutils literal notranslate"><span class="pre">at</span> <span class="pre">'03:00</span> <span class="pre">January</span> <span class="pre">1</span> <span class="pre">1999</span></code>, <code class="docutils literal notranslate"><span class="pre">at</span> <span class="pre">'now</span> <span class="pre">+</span> <span class="pre">30</span> <span class="pre">minutes'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTRL</span> <span class="pre">+</span> <span class="pre">d</span></code> to save</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">atq</span></code>, list jobs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">at</span> <span class="pre">-c</span> <span class="pre">JOB_ID</span></code>, show job description</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">atrm</span> <span class="pre">JOB_ID</span></code>, remove job</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="package-manager">
<h3>Package Manager<a class="headerlink" href="#package-manager" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>dnf</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">repolist</span></code>: show enabled repositories list</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">repolist</span> <span class="pre">--all</span></code>: show all repositories list</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">config-manager</span> <span class="pre">--enable</span> <span class="pre">REPO_ID</span></code>: enable repository</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">config-manager</span> <span class="pre">--disable</span> <span class="pre">REPO_ID</span></code>: disable repository</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">config-manager</span> <span class="pre">--add-repo</span> <span class="pre">REPO_URL</span></code>: add a repository</p></li>
<li><p>remove the file from <code class="docutils literal notranslate"><span class="pre">Repo-filename</span></code> output by <code class="docutils literal notranslate"><span class="pre">repolist</span> <span class="pre">-v</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">search</span> <span class="pre">'PKG'</span></code>: search for a package</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">group</span> <span class="pre">list</span></code>: list groups</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">group</span> <span class="pre">install</span> <span class="pre">'GROUP_NAME'</span></code>: install packages from group</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">install</span> <span class="pre">./app.rpm</span></code>: install from rpm file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">autoremove</span></code>: remove hanging dependencies</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">provides</span> <span class="pre">docker</span></code>: identify which package provides the app</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">repoquery</span> <span class="pre">-l</span> <span class="pre">moby-engine</span></code>: list which files are in the package</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="bash-scripts">
<h3>Bash Scripts<a class="headerlink" href="#bash-scripts" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#!/bin/bash</span></code>: ‘shebang’ should always be the first line of every script</p></li>
<li><p>commands in the script are the same as commands written in terminals</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">+x</span> <span class="pre">myscript.sh</span></code>: change script to be executable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/full/path/to/myscript.sh</span></code> or <code class="docutils literal notranslate"><span class="pre">./script.sh</span></code> to run the script</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">help</span></code>: list bash built-ins, use <code class="docutils literal notranslate"><span class="pre">help</span> <span class="pre">COMMAND</span></code> to print each built-in</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># this is a comment</span>

date<span class="w"> </span>&gt;&gt;<span class="w"> </span>/tmp/script.log
cat<span class="w"> </span>/proc/version<span class="w"> </span>&gt;&gt;<span class="w"> </span>/tmp/script.log
<span class="nb">echo</span><span class="w"> </span>hello<span class="w"> </span>&gt;&gt;<span class="w"> </span>/tmp/script.log

<span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>-f<span class="w"> </span>/tmp/archive.tar.gz<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>mv<span class="w"> </span>/tmp/archive.tar.gz<span class="w"> </span>/tmp/archive/tar.gz.OLD
<span class="w">    </span>tar<span class="w"> </span>acf<span class="w"> </span>/tmp/archive.tar.gz<span class="w"> </span>/etc/dnf/
<span class="k">else</span>
<span class="w">    </span>tar<span class="w"> </span>acf<span class="w"> </span>/tmp/archive/tar.gz<span class="w"> </span>/etc/dnf/
<span class="k">fi</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="selinux">
<h3>SELinux<a class="headerlink" href="#selinux" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Security Enhanced Linux, a security module enabled by default, and allow detailed control</p></li>
<li><dl class="simple">
<dt><strong>SELinux context label</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-Z</span></code>, list context labels for files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unconfined_u:object_r:user_home_t:s0</span></code>: ‘user:role:type:level’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">axZ</span></code>: list context labels for processes</p></li>
<li><p>processes with <code class="docutils literal notranslate"><span class="pre">unconfined_t</span></code> domain are running unrestricted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">-Z</span></code>: list context for current user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">semanage</span> <span class="pre">login</span> <span class="pre">-l</span></code>: check user mapping to SELinux ‘user’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">semanage</span> <span class="pre">user</span> <span class="pre">-l</span></code>: check users mapping to SELinux ‘users’</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>has policy configuration</p></li>
<li><p>every user logged in is mapped to SELinux ‘user’, and each ‘user’ can only assume
predefined ‘roles’</p></li>
<li><p>‘type’ restrict what an object can do, called ‘domain’ on processes</p></li>
<li><p>‘level’ is never used on regular systems, only used in enterprises</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getenforce</span></code>: check SELinux enabled or not (<code class="docutils literal notranslate"><span class="pre">Enforcing</span></code>, <code class="docutils literal notranslate"><span class="pre">Permissive</span></code>, <code class="docutils literal notranslate"><span class="pre">Disabled</span></code>)</p></li>
<li><dl class="simple">
<dt><strong>Benefits</strong></dt><dd><ul>
<li><p>only certain users can enter certain roles and types</p></li>
<li><p>lets authorized users and processes do their job</p></li>
<li><p>authorized users and processes are allowed to take only a limited set of actions</p></li>
<li><p>everything else is denied</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="kernel-runtime-parameters">
<h3>Kernel Runtime Parameters<a class="headerlink" href="#kernel-runtime-parameters" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sysctl</span> <span class="pre">-a</span></code>: list all kernel runtime parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sysctl</span> <span class="pre">-w</span> <span class="pre">runtime.para.name=1</span></code>: set parameter value (non persistent)</p></li>
<li><p>add files in <code class="docutils literal notranslate"><span class="pre">/etc/sysctl.d/*.conf</span></code>: persistent change</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sysctl</span> <span class="pre">-p</span> <span class="pre">/etc/sysctl.d/custom.conf</span></code>: read value from file</p></li>
</ul>
</div></blockquote>
</section>
<section id="users">
<h3>Users<a class="headerlink" href="#users" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Shadow package contains programs for handling passwords in a secure way</p></li>
<li><p>check <code class="docutils literal notranslate"><span class="pre">doc/HOWTO</span></code> in Shadow source directory for full explanation</p></li>
<li><p>when using Shadow support, programs that verify passwords, such as display managers, FTP
programs, pop3 daemons must be Shadow-compliant</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pwconv</span></code>: enable shadowed passwords</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grpconv</span></code>: enable shadowed group passwords</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">useradd</span></code> by default creates user and group with same name, and IDs start at 1000</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">useradd</span> <span class="pre">newUser</span></code>: add new user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">useradd</span> <span class="pre">-D</span></code> or <code class="docutils literal notranslate"><span class="pre">/etc/login.defs</span></code>: list defaults</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">passwd</span> <span class="pre">newUser</span></code>: set password for user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">userdel</span> <span class="pre">newUser</span></code>: delete user but <code class="docutils literal notranslate"><span class="pre">/home</span></code> directory will not be deleted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">userdel</span> <span class="pre">-r</span> <span class="pre">newUser</span></code>: delete user and <code class="docutils literal notranslate"><span class="pre">/home</span></code> directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">useradd</span> <span class="pre">-s</span> <span class="pre">/bin/shell1</span> <span class="pre">-d</span> <span class="pre">/home/dir1</span> <span class="pre">newUser</span></code>: change default shell and home directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">useradd</span> <span class="pre">-u</span> <span class="pre">1111</span> <span class="pre">newUser</span></code>: set user ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code>: file contains user details</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code>: list users and ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">useradd</span> <span class="pre">--system</span> <span class="pre">sysAcc</span></code>: create system account</p></li>
<li><p>system accounts has ID less than 1000, and are for programs, used by daemons, and no
<code class="docutils literal notranslate"><span class="pre">/home</span></code> is created</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usermod</span> <span class="pre">-d</span> <span class="pre">/home/dir1</span> <span class="pre">-m</span> <span class="pre">user1</span></code>: change user home directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usermod</span> <span class="pre">-l</span> <span class="pre">user2</span> <span class="pre">user1</span></code>: change user name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usermod</span> <span class="pre">-L</span> <span class="pre">user1</span></code>: lock user account (will be able to login if ssh with key is setup)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usermod</span> <span class="pre">-U</span> <span class="pre">user1</span></code>: unlock user account</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usermod</span> <span class="pre">-e</span> <span class="pre">2049-1-1</span> <span class="pre">user1</span></code>: set expiration date for user account (year-month-day)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usermod</span> <span class="pre">-e</span> <span class="pre">&quot;&quot;</span> <span class="pre">user1</span></code>: remove expiration date for user account</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chage</span> <span class="pre">-d</span> <span class="pre">0</span> <span class="pre">user1</span></code>: set expiration date for user password (user must change password)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chage</span> <span class="pre">-d</span> <span class="pre">-1</span> <span class="pre">user1</span></code>: remove expiration for user password</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chage</span> <span class="pre">-M</span> <span class="pre">30</span> <span class="pre">user1</span></code>: user must change password every month</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chage</span> <span class="pre">-M</span> <span class="pre">-1</span> <span class="pre">user1</span></code>: user password never expires</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chage</span> <span class="pre">--list</span> <span class="pre">user1</span></code>: list passwords expiration dates</p></li>
</ul>
</div></blockquote>
</section>
<section id="groups">
<h3>Groups<a class="headerlink" href="#groups" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>certain groups allow root privileges (e.g <code class="docutils literal notranslate"><span class="pre">wheel</span></code>)</p></li>
<li><dl class="simple">
<dt><strong>Primary group</strong></dt><dd><ul>
<li><p>also called Login group</p></li>
<li><p>a program runs with the same privileges as the user’s primary group</p></li>
<li><p>files created will be owned by the user and the primary group</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">groups</span></code>: show user’s groups</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groupadd</span> <span class="pre">newGroup</span></code>: add new group</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gpasswd</span> <span class="pre">-a</span> <span class="pre">newUser</span> <span class="pre">newGroup</span></code>: add user to group</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groups</span> <span class="pre">newUser</span></code>: list groups ‘newUser’ belong to</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gpasswd</span> <span class="pre">-d</span> <span class="pre">newUser</span> <span class="pre">newGroup</span></code>: remove user from group</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usermod</span> <span class="pre">-g</span> <span class="pre">newGroup</span> <span class="pre">newUser</span></code>: change user’s primary group</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groupmod</span> <span class="pre">-n</span> <span class="pre">oldGroup</span> <span class="pre">newGroup</span></code>: change group name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">groupdel</span> <span class="pre">newGroup</span></code>: delete group (cannot delete if group is user’s primary)</p></li>
</ul>
</div></blockquote>
</section>
<section id="environment-variables">
<h3>Environment Variables<a class="headerlink" href="#environment-variables" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">printenv</span></code> or <code class="docutils literal notranslate"><span class="pre">env</span></code>: list environment variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">$HOME</span></code>: print an environment variable value</p></li>
<li><p>can edit <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> file to set variables</p></li>
<li><p>place scripts in <code class="docutils literal notranslate"><span class="pre">/etc/profile.d/</span></code> to be executed at login</p></li>
<li><p>place files in <code class="docutils literal notranslate"><span class="pre">/etc/skel/</span></code> to have default files for new users in their <code class="docutils literal notranslate"><span class="pre">/home</span></code></p></li>
<li><p>edit <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> variable to add more paths</p></li>
</ul>
</div></blockquote>
</section>
<section id="resource-limits">
<h3>Resource Limits<a class="headerlink" href="#resource-limits" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>edit <code class="docutils literal notranslate"><span class="pre">/etc/security/limits.conf</span></code> to limit users resources</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">-a</span></code>: list current user limits</p></li>
<li><p>users can only lower limits by default</p></li>
<li><p>users can raise to hard limit only once</p></li>
</ul>
</div></blockquote>
</section>
<section id="privileges">
<h3>Privileges<a class="headerlink" href="#privileges" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>users part of <code class="docutils literal notranslate"><span class="pre">wheel</span></code> group are allowed to run commands as root</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">gpasswd</span> <span class="pre">-a</span> <span class="pre">user1</span> <span class="pre">wheel</span></code>:add user to <code class="docutils literal notranslate"><span class="pre">wheel</span></code> group</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/sudoers</span></code> defines who can use which commands with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>, never edit directly</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">visudo</span></code>: edit <code class="docutils literal notranslate"><span class="pre">/etc/sudoers</span></code> file safely</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-u</span> <span class="pre">user1</span> <span class="pre">ls</span></code>: run as commands ‘user1’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-iu</span> <span class="pre">user1</span></code>: login as user1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">-i</span></code> or <code class="docutils literal notranslate"><span class="pre">su</span> <span class="pre">-l</span></code> or <code class="docutils literal notranslate"><span class="pre">su</span> <span class="pre">-</span></code>: login as root</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">passwd</span> <span class="pre">root</span></code>: set new password for root</p></li>
</ul>
</div></blockquote>
</section>
<section id="acls">
<h3>ACLs<a class="headerlink" href="#acls" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>define specific permissions to two or more users/groups</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">--modify</span> <span class="pre">user:user2:rw</span> <span class="pre">FILE</span></code>: ‘user2’ can access while other non-owners can’t</p></li>
<li><p>files with ACL will have <code class="docutils literal notranslate"><span class="pre">+</span></code> when <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getfacl</span> <span class="pre">FILE</span></code>: check for ACL</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code> defines maximum permissions file/directory can have, useful to limit
existing permissions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">--modify</span> <span class="pre">mask:r</span> <span class="pre">FILE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">--modify</span> <span class="pre">group:gp1:rw</span> <span class="pre">FILE</span></code>: set ACL for ‘gp1’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">--modify</span> <span class="pre">user:user2:---</span> <span class="pre">FILE</span></code>: deny all permissions for ‘user2’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">--remove</span> <span class="pre">user:user2</span> <span class="pre">FILE</span></code>: remove ACL for ‘user2’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">--remove</span> <span class="pre">group:gp1</span> <span class="pre">FILE</span></code>: remove ACL for ‘gp1’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">--recursive</span> <span class="pre">-m</span> <span class="pre">user:user2:rwx</span> <span class="pre">DIR1/</span></code>: define ACL recursively</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setfacl</span> <span class="pre">--recursive</span> <span class="pre">--remove</span> <span class="pre">user:user2</span> <span class="pre">DIR1/</span></code>: remove ACL recursively</p></li>
</ul>
</div></blockquote>
</section>
<section id="network-management">
<h3>Network Management<a class="headerlink" href="#network-management" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">l</span></code> or <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">a</span></code>: list network interfaces</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">r</span></code>: list route table</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code>: dns resolver file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/sysconfig/network-scripts/</span></code>: system configure network according to files in the it</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code>: edit the file for static host names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">NetworkManager.service</span></code>: daemon that starts network settings and devices</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ss</span> <span class="pre">-tunlp</span></code> or <code class="docutils literal notranslate"><span class="pre">netstat</span> <span class="pre">-tunlp</span></code>: list listening connections</p></li>
<li><dl class="simple">
<dt><strong>nmcli</strong></dt><dd><ul class="simple">
<li><p>can use <code class="docutils literal notranslate"><span class="pre">nmcli</span></code> or <code class="docutils literal notranslate"><span class="pre">nmtui</span></code> to edit network configurations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nmcli</span> <span class="pre">device</span> <span class="pre">reapply</span> <span class="pre">eno1</span></code>: apply changes without reboot</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nmcli</span> <span class="pre">connection</span> <span class="pre">show</span></code>: list configured connections</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nmcli</span> <span class="pre">connection</span> <span class="pre">modify</span> <span class="pre">MyWifi</span> <span class="pre">autoconnect</span> <span class="pre">yes</span></code>: configure device to auto connect</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nmcli</span> <span class="pre">device</span> <span class="pre">wifi</span> <span class="pre">hotspot</span> <span class="pre">con-name</span> <span class="pre">&lt;name&gt;</span> <span class="pre">ssid</span> <span class="pre">&lt;ssid&gt;</span> <span class="pre">password</span> <span class="pre">&lt;password&gt;</span></code>: create
hotspot from device</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nmcli</span> <span class="pre">connection</span> <span class="pre">down</span> <span class="pre">&lt;name&gt;</span></code>: disable hotspot</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>Connecting to wifi</strong></p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nmcli<span class="w"> </span>device<span class="w"> </span>wifi<span class="w"> </span>list<span class="w"> </span>--rescan<span class="w"> </span>yes
nmcli<span class="w"> </span>device<span class="w"> </span>wifi<span class="w"> </span>connect<span class="w"> </span>SSID<span class="w"> </span>password<span class="w"> </span><span class="s2">&quot;PASSWORD&quot;</span>
ncmli<span class="w"> </span>connection<span class="w"> </span>show
nmcli<span class="w"> </span>connection<span class="w"> </span>down<span class="w"> </span>CURRENT_CONNECTION
nmcli<span class="w"> </span>connection<span class="w"> </span>up<span class="w"> </span>NEW_CONNECTION
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</section>
<section id="firewall">
<h3>Firewall<a class="headerlink" href="#firewall" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--get-default-zone</span></code>: list default zone</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--set-default-zone=public</span></code>: set default zone</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--list-all</span></code>: list current firewall rules</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--info-service=ssh</span></code>: list service details</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--add-service=http</span></code> or <code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--add-port=80/tcp</span></code>: allow traffic</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--remove-service=http</span></code> or <code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--remove-port=80/tcp</span></code>: remove</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--get-active-zones</span></code>: list active zones</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--add-source=10.11.12.0/24</span> <span class="pre">--zone=trusted</span></code>: allow traffic based on IP</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--remove-source=10.11.12.0/24</span> <span class="pre">--zone=trusted</span></code>: remove from zone</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--runtime-to-permanent</span></code> or <code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--add-port=80/tcp</span> <span class="pre">--permanent</span></code></p></li>
</ul>
</div></blockquote>
</section>
<section id="static-routing">
<h3>Static Routing<a class="headerlink" href="#static-routing" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">route</span> <span class="pre">add</span> <span class="pre">192.168.0.0/24</span> <span class="pre">via</span> <span class="pre">10.0.0.100</span> <span class="pre">dev</span> <span class="pre">eno3</span></code>: add new route</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">route</span> <span class="pre">del</span> <span class="pre">192.168.0.0/24</span></code>: delete route</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">route</span> <span class="pre">add</span> <span class="pre">default</span> <span class="pre">via</span> <span class="pre">10.0.0.100</span></code>: add default gateway</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">route</span> <span class="pre">del</span> <span class="pre">default</span> <span class="pre">via</span> <span class="pre">10.0.0.100</span></code>: delete default gateway</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nmcli</span> <span class="pre">connection</span> <span class="pre">modify</span> <span class="pre">en03</span> <span class="pre">+ipv4.routes</span> <span class="pre">&quot;192.168.0.0/24</span> <span class="pre">10.0.0.100&quot;</span></code>: route permanent</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nmcli</span> <span class="pre">connection</span> <span class="pre">modify</span> <span class="pre">en03</span> <span class="pre">-ipv4.routes</span> <span class="pre">&quot;192.168.0.0/24</span> <span class="pre">10.0.0.100&quot;</span></code>: remove route</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nmcli</span> <span class="pre">device</span> <span class="pre">reapply</span> <span class="pre">eno3</span></code>: apply changes</p></li>
</ul>
</div></blockquote>
</section>
<section id="time-synchronisation">
<h3>Time Synchronisation<a class="headerlink" href="#time-synchronisation" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chronyd.service</span></code> updates system clock periodically</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timedatectl</span></code>: list current timezone</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timedatectl</span> <span class="pre">set-timezone</span> <span class="pre">Region/City</span></code>: set timezone</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timedatectl</span> <span class="pre">list-timezones</span></code>: list timezones</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">set-ntp</span> <span class="pre">true</span></code>: activate NTP service</p></li>
</ul>
</div></blockquote>
</section>
<section id="bind">
<h3>Bind<a class="headerlink" href="#bind" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bind</span></code>, including <code class="docutils literal notranslate"><span class="pre">bind-utils</span></code>, is popular for hosting dns server</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/named.conf</span></code>: configuration file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">named.service</span></code>: start bind</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--add-service=dns</span> <span class="pre">--permanent</span></code>: allow connection to dns service</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dig</span> <span class="pre">&#64;localhost</span> <span class="pre">google.com</span></code>: check bind working or not</p></li>
<li><p>zone: group dns data for specific domain</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/named/</span></code>: contains example zone files</p></li>
</ul>
</div></blockquote>
</section>
<section id="email">
<h3>Email<a class="headerlink" href="#email" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>incoming emails are saved in <code class="docutils literal notranslate"><span class="pre">/var/spool/mail/</span></code> directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">postfix</span></code> is widely used to setup mail server</p></li>
<li><p>can add new aliases in <code class="docutils literal notranslate"><span class="pre">/etc/aliases</span></code></p></li>
<li><dl class="simple">
<dt><strong>IMAPS</strong></dt><dd><ul>
<li><p>Internet Message Access Protocol over SSL (early IMAP does not encrypt)</p></li>
<li><p>can use <code class="docutils literal notranslate"><span class="pre">dovecot</span></code> daemon to setup IMAPS</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="ssh">
<h3>SSH<a class="headerlink" href="#ssh" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>listens on port <code class="docutils literal notranslate"><span class="pre">22</span></code> by default, <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">user&#64;IP</span></code> to SSH remote login</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/ssh/ssh_config</span></code>: client configuration file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/ssh/sshd_config</span></code>: server configuration file</p></li>
<li><p>edit files in <code class="docutils literal notranslate"><span class="pre">/etc/ssh/ssh_config.d/</span></code> and <code class="docutils literal notranslate"><span class="pre">/etc/ssh/sshd_config.d/</span></code> to prevent reset</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$HOME/.ssh/config</span></code>: file to specify users and IP (use <code class="docutils literal notranslate"><span class="pre">600</span></code> permission)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssh-keygen</span></code>: generate ssh key pairs which are stored in <code class="docutils literal notranslate"><span class="pre">$HOME/.ssh/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssh-copy-id</span> <span class="pre">user&#64;server</span></code>: copy the public key to the server</p></li>
<li><p>can also manually edit <code class="docutils literal notranslate"><span class="pre">$HOME/.ssh/authorized_keys</span></code> to copy public key</p></li>
<li><p>it is better to generate ssh key pairs on the client, so that only public key has to
be copied over the Internet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssh-keygen</span> <span class="pre">-R</span> <span class="pre">IP</span></code>: remove old finger prints from <code class="docutils literal notranslate"><span class="pre">known_hosts</span></code></p></li>
</ul>
</div></blockquote>
</section>
<section id="http">
<h3>HTTP<a class="headerlink" href="#http" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>HTTP Proxy</strong></dt><dd><ul>
<li><p>can use <code class="docutils literal notranslate"><span class="pre">squid</span></code> daemon to setup http proxy server</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--add-service=squid</span> <span class="pre">--permanent</span></code>: allow connection to squid</p></li>
<li><p>edit <code class="docutils literal notranslate"><span class="pre">etc/squid/squid.conf</span></code> for configuration</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>HTTP Server</strong></dt><dd><ul>
<li><p>Apache <code class="docutils literal notranslate"><span class="pre">httpd</span></code> daemon is widely used with <code class="docutils literal notranslate"><span class="pre">mod_ssl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--add-service=http</span></code> and <code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--add-service=https</span></code></p></li>
<li><p>configuration files are in <code class="docutils literal notranslate"><span class="pre">/etc/httpd/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/httpd/conf/httpd.conf</span></code>: primary configuration file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apachectl</span> <span class="pre">configtest</span></code>: check configuration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/httpd/conf.d/ssl.conf</span></code>: default ssl configuration</p></li>
<li><p>most modules are auto enabled when installed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/log/httpd/</span></code>: default log directory</p></li>
<li><p>logging is done by <code class="docutils literal notranslate"><span class="pre">log_config_module</span></code></p></li>
<li><p>it is recommended to separate log files by each host</p></li>
<li><p>can restrict access by editing <code class="docutils literal notranslate"><span class="pre">Options</span> <span class="pre">Indexes</span> <span class="pre">FollowSymLinks</span></code>, <code class="docutils literal notranslate"><span class="pre">Require</span> <span class="pre">all</span> <span class="pre">granted</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">htpasswd</span> <span class="pre">-c</span> <span class="pre">/etc/httpd/passwords</span> <span class="pre">user1</span></code>: create hashed password file for user1</p></li>
<li><p>generated password file can be used for authentication with <code class="docutils literal notranslate"><span class="pre">AuthType</span></code>,
<code class="docutils literal notranslate"><span class="pre">AuthBasicProvider</span></code>, <code class="docutils literal notranslate"><span class="pre">AuthName</span></code>, <code class="docutils literal notranslate"><span class="pre">AuthUserFile</span></code> and <code class="docutils literal notranslate"><span class="pre">Require</span></code> options</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="database-server">
<h3>Database Server<a class="headerlink" href="#database-server" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mariadb</span></code>: a fork of mysql, can be used to setup database server</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">firewall-cmd</span> <span class="pre">--add-service=mysql</span> <span class="pre">--permanent</span></code>: open firewall if needed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mysql_secure_installation</span></code>: setup to secure the database</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/my.cnf.d/mariadb-server.cnf</span></code>: main configuration file</p></li>
</ul>
</div></blockquote>
</section>
<section id="devices-disks">
<h3>Devices &amp; Disks<a class="headerlink" href="#devices-disks" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>Block Devices</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lsblk</span></code>: list block devices</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">fdisk</span> <span class="pre">--list</span> <span class="pre">/dev/sda</span></code>: list partitions of a device</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">cfdisk</span> <span class="pre">/dev/sda</span></code>: edit disk partition table interactively</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Disk Imaging</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">dd</span> <span class="pre">if=INPUT</span> <span class="pre">of=OUTPUT</span> <span class="pre">bs=BLOCK_SIZE</span> <span class="pre">status=progress</span></code></p></li>
<li><p>should unmount the disk first to avoid changes and should not use in VMs</p></li>
<li><p>swap <code class="docutils literal notranslate"><span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">of</span></code> to restore</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Swap</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">swapon</span> <span class="pre">--show</span></code>: check swap usage</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkswap</span> <span class="pre">/dev/sdb3</span></code>: prepare the partition</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">swapon</span> <span class="pre">--verbose</span> <span class="pre">/dev/sdb3</span></code>: use partition as swap</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">swapoff</span> <span class="pre">/dev/sdb3</span></code>: stop using partition as swap</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>File as Swap</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">dd</span> <span class="pre">if=/dev/zero</span> <span class="pre">of=/swap</span> <span class="pre">bs=1M</span> <span class="pre">count=128</span> <span class="pre">status=progress</span></code>: prepare the file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">600</span> <span class="pre">/swap</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkswap</span> <span class="pre">/swap</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">swapon</span> <span class="pre">--verbose</span> <span class="pre">/swap</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Disk Quotas</strong></dt><dd><ul>
<li><p>can use <code class="docutils literal notranslate"><span class="pre">quota</span></code> to set quotas</p></li>
<li><p>can limit storage and how may files and directories can be created</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Disk Quotas for ext File System</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">quotacheck</span> <span class="pre">--create-files</span> <span class="pre">--user</span> <span class="pre">--group</span> <span class="pre">/dev/sdb2</span></code>: create files to track usage</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quotaon</span> <span class="pre">/mnt/</span></code>: turn on quota if mounted on <code class="docutils literal notranslate"><span class="pre">/mnt/</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Disk Quotas for xfs File System</strong></dt><dd><ul>
<li><p>can edit <code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code> to have <code class="docutils literal notranslate"><span class="pre">defaults,usrquota,grpquota</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quota</span> <span class="pre">--user</span> <span class="pre">user1</span></code>: list quotas for ‘user1’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">edquota</span> <span class="pre">--user</span> <span class="pre">user1</span></code>: edit quotas for ‘user1’</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">edquota</span> <span class="pre">--group</span> <span class="pre">gp1</span></code>: edit quotas for ‘gp1’</p></li>
<li><p>1 block is 1KB</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fallocate</span> <span class="pre">--lenght</span> <span class="pre">100M</span> <span class="pre">FILE1</span></code>: create 100MB file to test quota</p></li>
<li><p>allowed to exceed soft limit for specific days, <code class="docutils literal notranslate"><span class="pre">grace</span> <span class="pre">period</span></code></p></li>
<li><p>set inodes limit to limit files and directories</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quota</span> <span class="pre">--edit-period</span></code>: edit grace period</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="creating-file-systems">
<h3>Creating File Systems<a class="headerlink" href="#creating-file-systems" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>file system needs to be created before a partition can be used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkfs.xfs</span> <span class="pre">/dev/sdb1</span></code>: create xfs file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">xfs_admin</span></code>: modify xfs file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkfs.ext4</span> <span class="pre">/dev/sdb1</span></code>: create ext4 file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">tune2fs</span> <span class="pre">-l</span> <span class="pre">/dev/sdb1</span></code>: modify ext based file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mount</span> <span class="pre">/dev/sdb1</span> <span class="pre">/mnt/</span></code>: mount a file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">umount</span> <span class="pre">/mnt/</span></code>: unmount a file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code>: file that instructs which file systems to be mounted automatically, use
UUID instead of device names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">blkid</span> <span class="pre">/dev/sdb1</span></code>: check UUID</p></li>
<li><dl class="simple">
<dt><strong>On-demand Mounting</strong></dt><dd><ul>
<li><p>only mount when needed, useful when using remote servers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">autofs</span></code> daemon can be used, usually with <code class="docutils literal notranslate"><span class="pre">nfs-utils</span></code></p></li>
<li><p>edit <code class="docutils literal notranslate"><span class="pre">/etc/exports</span></code> for network sharing</p></li>
<li><p>edit <code class="docutils literal notranslate"><span class="pre">/etc/auto.master</span></code> to configure <code class="docutils literal notranslate"><span class="pre">autofs</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mount</span> <span class="pre">-o</span> <span class="pre">ro,noexec,nosuid</span> <span class="pre">/dev/sdb1</span> <span class="pre">/mnt</span></code>, mount file system with specific options</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mount</span> <span class="pre">-o</span> <span class="pre">remount,ro</span> <span class="pre">/dev/sdb1</span> <span class="pre">/mnt</span></code>, remount file system with new options</p></li>
<li><p>it is better to do <code class="docutils literal notranslate"><span class="pre">umount</span></code> and <code class="docutils literal notranslate"><span class="pre">mount</span></code> again with new options</p></li>
<li><dl class="simple">
<dt><strong>Checking File System</strong></dt><dd><ul>
<li><p>must be unmounted before checking</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xfs_repair</span> <span class="pre">-v</span> <span class="pre">/dev/sda1</span></code>: repair XFS file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fsck.ext4</span> <span class="pre">-v</span> <span class="pre">-f</span> <span class="pre">-p</span> <span class="pre">/dev/sda1</span></code>: check ext4 file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">findmnt</span></code>: find file systems and mount points</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">findmnt</span> <span class="pre">-t</span> <span class="pre">xfs,ext4</span></code>: show only xfs and ext4</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>: check file system usage, add <code class="docutils literal notranslate"><span class="pre">-h</span></code> to show in human-readable form</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="lvm">
<h3>LVM<a class="headerlink" href="#lvm" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Logical Volume Manager, to create virtual block devices</p></li>
<li><p>can represent separate physical devices as one continuous partition</p></li>
<li><p>PV: physical volume, VG: volume group, LV: logical volume, PE: physical extent</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lvmdiskscan</span></code>: list available PV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pvcreate</span> <span class="pre">/dev/sdb</span> <span class="pre">/dev/sdd</span></code>: create pv to be used by LVM</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pvs</span></code>: list current attached PV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vgcreate</span> <span class="pre">vg1</span> <span class="pre">/dev/sdb</span> <span class="pre">/dev/sdd</span></code>: add PV to VG</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vgextend</span> <span class="pre">vg1</span> <span class="pre">/dev/sde</span></code>: add new PV to existing VG</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vgreduce</span> <span class="pre">vg1</span> <span class="pre">/dev/sde</span></code>: remove PV from VG</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pvremove</span> <span class="pre">/dev/sde</span></code>: remove PV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lvcreate</span> <span class="pre">--size</span> <span class="pre">8GB</span> <span class="pre">--name</span> <span class="pre">partition1</span> <span class="pre">vg1</span></code>: create LV from existing VG</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lvs</span></code>: list LV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vgs</span></code>: list VG</p></li>
<li><p>data in LVM is divided into multiple PEs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lvresize</span> <span class="pre">--extents</span> <span class="pre">100%VG</span> <span class="pre">vg1/partition1</span></code>: resize LV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lvresize</span> <span class="pre">--size</span> <span class="pre">8G</span> <span class="pre">vg1/partition1</span></code>: shrink LV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lvdisplay</span></code>: information about LV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mkfs.xfs</span> <span class="pre">/dev/vg1/partition1</span></code>: create file system on LV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lvresize</span> <span class="pre">--resizefs</span> <span class="pre">--size</span> <span class="pre">3G</span> <span class="pre">vg1/partition1</span></code>: resize both LV and file system</p></li>
</ul>
</div></blockquote>
</section>
<section id="device-encryption">
<h3>Device Encryption<a class="headerlink" href="#device-encryption" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cryptsetup</span></code>: encrypt storage device</p></li>
<li><dl class="simple">
<dt>encrypted disks can be found in <code class="docutils literal notranslate"><span class="pre">/dev/mapper/</span></code>, and is same as regular disk</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mkfs.xfs</span> <span class="pre">/dev/mapper/mysecuredisk</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">/dev/mapper/mysecuredisk</span> <span class="pre">/mnt</span></code>, can be mounted</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Plain Mode</strong></dt><dd><ul>
<li><p>takes password and encrypt all data with it</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cryptsetup</span> <span class="pre">--verify-passphrase</span> <span class="pre">open</span> <span class="pre">--type</span> <span class="pre">plain</span> <span class="pre">/dev/sda</span> <span class="pre">mysecuredisk</span></code>: can read
decrypted data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cryptsetup</span> <span class="pre">close</span> <span class="pre">mysecuredisk</span></code>: can only read encrypted data</p></li>
<li><p>changing password requires encrypting all data again</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>LUKS Extension</strong></dt><dd><ul>
<li><p>Linux Unified Key Setup, default mode and more user friendly to setup</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cryptsetup</span> <span class="pre">luksFormat</span> <span class="pre">/dev/sda</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cryptsetup</span> <span class="pre">luksChangeKey</span></code>: change encryption key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cryptsetup</span> <span class="pre">open</span> <span class="pre">/dev/sda</span> <span class="pre">mysecuredisk</span></code>: can read decrypted data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cryptsetup</span> <span class="pre">close</span> <span class="pre">mysecuredisk</span></code>: can only read encrypted data</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="raid">
<h3>RAID<a class="headerlink" href="#raid" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Redundant Array of Independent Disks, combine multiple storage devices into single one</p></li>
<li><p>unlike from LVM, RAID provides any options for redundancy or parity</p></li>
<li><dl class="simple">
<dt><strong>Level 0</strong></dt><dd><ul>
<li><p>striped array, not redundant</p></li>
<li><p>disks are groups and Linux sees them as single storage</p></li>
<li><p>total usable storage equals to sum of total devices</p></li>
<li><p>data on entire array will be lost just by losing one disk</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Level 1</strong></dt><dd><ul>
<li><p>mirrored array</p></li>
<li><p>when writing data to one disk, the same data is written to all disks</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Level 5</strong></dt><dd><ul>
<li><p>require minimum of 3 disks, can lose up to one disk</p></li>
<li><p>keep parity, information to rebuild data, on each disk</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Level 6</strong></dt><dd><ul>
<li><p>require minimum of 4 disks, can lose up to two disks</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Level 10/ RAID 1+0</strong></dt><dd><ul>
<li><p>has advantages of both Level 0 and 1</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mdadm</span> <span class="pre">--create</span> <span class="pre">/dev/md0</span> <span class="pre">--level=0</span> <span class="pre">--raid-devices=3</span> <span class="pre">/dev/sda</span> <span class="pre">/dev/sdb</span> <span class="pre">/dev/sdc</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mkfs.ext4</span> <span class="pre">/dev/md0</span></code>: can create file system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mdadm</span> <span class="pre">--stop</span> <span class="pre">/dev/md0</span></code>: deactivate array</p></li>
<li><p>when reboot, Linux scans for superblock on devices to auto rebuild the array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mdadm</span> <span class="pre">--zero-superblock</span> <span class="pre">/dev/sda</span> <span class="pre">/dev/sdb</span> <span class="pre">/dev/sdc</span></code>: not to rebuild the array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mdam</span> <span class="pre">--create</span> <span class="pre">/dev/md0</span> <span class="pre">--level=1</span> <span class="pre">--raid-devices</span> <span class="pre">/dev/sda</span> <span class="pre">/dev/sdb</span> <span class="pre">--spare-devices=1</span> <span class="pre">/dev/sdc</span></code>,
will auto add <cite>/dev/sdc</cite> if one of the disks fails</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mdam</span> <span class="pre">--manage</span> <span class="pre">/dev/md0</span> <span class="pre">--add</span> <span class="pre">/dev/sdc</span></code>: add new disk to the array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mdam</span> <span class="pre">--manage</span> <span class="pre">/dev/md0</span> <span class="pre">--remove</span> <span class="pre">/dev/sdc</span></code>: remove disk from the array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/proc/mdstat</span></code>: file contains information about RAID</p></li>
</ul>
</div></blockquote>
<p><a class="reference external" href="#linux">back to top</a></p>
</section>
</section>
<section id="memory-management">
<h2>Memory Management<a class="headerlink" href="#memory-management" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#virtual-memory">Virtual Memory</a>, <a class="reference internal" href="#memory-management-unit">Memory Management Unit</a>, <a class="reference internal" href="#kernel-virtual-memory">Kernel Virtual Memory</a></p></li>
<li><p><a class="reference internal" href="#kernel-logical-addresses">Kernel Logical Addresses</a>, <a class="reference internal" href="#kernel-virtual-addresses">Kernel Virtual Addresses</a>, <a class="reference internal" href="#user-virtual-addresses">User Virtual Addresses</a></p></li>
<li><p><a class="reference internal" href="#user-space-allocation">User-Space Allocation</a></p></li>
</ul>
<section id="virtual-memory">
<h3>Virtual Memory<a class="headerlink" href="#virtual-memory" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>system that uses an address mapping, virtual address space to physical address space</p></li>
<li><p>Physical Address: used by hardware, e.g. DMA (Direct Memory Access), peripherals</p></li>
<li><p>Virtual Address: used by software, e.g. Load/Store instructions (RISC), any instruction
accessing memory (CISC)</p></li>
<li><p>maps to physical RAM, and hardware devices like PCI devices, GPU RAM, On-SoC IP blocks</p></li>
<li><p>each process can have different memory mapping, making one process’s RAM inaccessible to
others</p></li>
<li><p>kernel RAM is invisible to user-space processes</p></li>
<li><p>memory can be moved, or swapped to disk</p></li>
<li><p>kernel can map hardware device memory into a process’s address space</p></li>
<li><p>Shared Memory: physical RAM mapped into multiple processes at once</p></li>
<li><p>read, write, execute permissions can be set on memory regions</p></li>
<li><p>virtual memory mapping is assisted by hardware, MMU</p></li>
<li><p>no penalty for permissions and performance when accessing already-mapped regions</p></li>
<li><p>same CPU instructions are used for accessing RAM and mapped hardware</p></li>
<li><p>usually software will only use virtual addresses</p></li>
</ul>
</div></blockquote>
</section>
<section id="memory-management-unit">
<h3>Memory Management Unit<a class="headerlink" href="#memory-management-unit" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>MMU is a hardware responsible for virtual memory mapping</p></li>
<li><p>between CPU and memory, often part of CPU, but separate from memory controller</p></li>
<li><p>handles all memory accesses from Load/Store instructions, permissions, and
exception/page fault on invalid access</p></li>
<li><dl class="simple">
<dt><strong>Translation Lookaside Buffer</strong></dt><dd><ul>
<li><p>TLB is part of MMU system, a hardware buffer with a list of mappings from virtual to
physical address space, and permission bits</p></li>
<li><p>depending on CPU, TLB has a fixed number of entries</p></li>
<li><p>MMU checks the TLB when CPU accesses a virtual address</p></li>
<li><p>a page fault exception is generated, and the CPU interrupted when virtual address is
not in the TLB, or insufficient permissions</p></li>
<li><p>virtually contiguous regions do not have to be physically contiguous</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Page</strong></dt><dd><ul>
<li><p>basic units of memory, page size varies by architecture</p></li>
<li><p>Common Sizes: ARM 4k, ARM64 4k or 64k, MIPS configurable, x86 4k</p></li>
<li><p>architectures with configurable sizes are configured at kernel build time</p></li>
<li><p>Page Frame: page-sized and page-aligned physical memory block</p></li>
<li><p>a mapping often covers multiple pages</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Page Fault</strong></dt><dd><ul>
<li><p>CPU exception generated when software attempts to use invalid virtual address</p></li>
<li><p>can be caused by address not mapped, insufficient permissions, or valid address but
swapped out</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Page Table</strong></dt><dd><ul>
<li><p>kernel data structure to store the mappings, e.g. <code class="docutils literal notranslate"><span class="pre">struct_mm</span></code>, <code class="docutils literal notranslate"><span class="pre">vm_area_struct</span></code></p></li>
<li><p>CPU generate a page fault for some valid mappings that are not in TLB</p></li>
<li><p>page fault handler find the relevant mapping in page tables, select and remove
existing TLB entry, create a new TLB entry, and return to user space process</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Swapping</strong></dt><dd><ul>
<li><p>MMU enabling kernel to swap frames to disk, and remove its TLB entry to free up RAM</p></li>
<li><p>the frame can be reused by another process</p></li>
<li><p>when page fault, kernel put the process to sleep, copy the frame from disk into
unused frame in RAM, fix the page table entry, and wake the process</p></li>
<li><p>a page is not necessarily restored to the same physical frame, but has the same
virtual address to hide the difference from user-space process</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="kernel-virtual-memory">
<h3>Kernel Virtual Memory<a class="headerlink" href="#kernel-virtual-memory" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Linux kernel and user-space processes both use virtual address</p></li>
<li><p>Virtual Address Splitting: upper part for kernel, and lower part for user space</p></li>
<li><dl class="simple">
<dt><strong>On 32-bit System</strong></dt><dd><ul>
<li><p>by default, the split is at <code class="docutils literal notranslate"><span class="pre">0xC0000000</span></code>, <code class="docutils literal notranslate"><span class="pre">CONFIG_PAGE_OFFSET</span></code></p></li>
<li><p>kernel uses the top 1GB, and each user-space process gets the lower 3GB of virtual
address space</p></li>
<li><p>configurable at kernel build time, <code class="docutils literal notranslate"><span class="pre">CONFIG_VMSPLIT_*</span></code> option</p></li>
<li><p>in addition to 1GB, ~104MB is reserved at the top of kernel’s memory space for
non-contiguous allocations, such as space used by <code class="docutils literal notranslate"><span class="pre">vmalloc()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>On 64-bit System</strong></dt><dd><ul>
<li><p>split varies by architecture</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x8000000000000000</span></code> for ARM64, and <code class="docutils literal notranslate"><span class="pre">0xffff880000000000</span></code> for x86_64</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>3 Types of Virtual Addresses</strong></dt><dd><ul>
<li><p>Kernel: Kernel Logical Address, Kernel Virtual Address</p></li>
<li><p>User-Space: User Virtual Address</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="kernel-logical-addresses">
<h3>Kernel Logical Addresses<a class="headerlink" href="#kernel-logical-addresses" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>kernel normal address space, includes memory from <code class="docutils literal notranslate"><span class="pre">kmalloc()</span></code> and most allocation methods,
and kernel stacks of each process</p></li>
<li><p>can never be swapped out</p></li>
<li><dl class="simple">
<dt><strong>Fixed Mapping</strong></dt><dd><ul>
<li><p>fixed mapping between virtual and physical, converting from one another is easy</p></li>
<li><p>e.g. Virt: <code class="docutils literal notranslate"><span class="pre">0xC000000</span></code> -&gt; Phys: <code class="docutils literal notranslate"><span class="pre">0x00000000</span></code></p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">__pad(x)</span></code> and <code class="docutils literal notranslate"><span class="pre">__va(x)</span></code> macros for conversion</p></li>
<li><p>virtually contiguous regions are also physically contiguous</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>for fixed mapping and non-swappable, kernel logical addresses are suitable for DMA
transfers</p></li>
<li><dl class="simple">
<dt><strong>For Small-Memory System</strong></dt><dd><ul>
<li><p>systems with less than 1GB of RAM</p></li>
<li><p>kernel logical address space is from <code class="docutils literal notranslate"><span class="pre">PAGE_OFFSET</span></code> to the end of physical memory</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>For Large-Memory System</strong></dt><dd><ul>
<li><p>systems with more than 1GB of RAM</p></li>
<li><p>on 32-bit systems, only bottom part of physical RAM is mapped directly into kernel
logical address space</p></li>
<li><p>64-bit systems have enough kernel address space to accommodate all the RAM</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="kernel-virtual-addresses">
<h3>Kernel Virtual Addresses<a class="headerlink" href="#kernel-virtual-addresses" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>addresses above kernel logical address mapping, can also called <code class="docutils literal notranslate"><span class="pre">vmalloc()</span></code> area</p></li>
<li><p>for non-contiguous mappings, <code class="docutils literal notranslate"><span class="pre">vmalloc()</span></code>, and memory-mapped I/O, <code class="docutils literal notranslate"><span class="pre">ioremap()</span></code>, <code class="docutils literal notranslate"><span class="pre">kmap()</span></code></p></li>
<li><p>physically non-contiguous, easier to allocate, but unsuitable for DMA</p></li>
</ul>
</div></blockquote>
</section>
<section id="user-virtual-addresses">
<h3>User Virtual Addresses<a class="headerlink" href="#user-virtual-addresses" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>used by user-space programs, all addresses below <code class="docutils literal notranslate"><span class="pre">PAGE_OFFSET</span></code></p></li>
<li><p>mapping per process, threads share a mapping, and complex behaviour with <code class="docutils literal notranslate"><span class="pre">clone()</span></code></p></li>
<li><p>only used portions of RAM are mapped</p></li>
<li><p>memory can be swapped out and moved, and is not contiguous</p></li>
<li><p>user buffers are not suitable for kernel use or DMA</p></li>
<li><p>mapping is changed at context switch time</p></li>
<li><p>same virtual addresses in two different processes will likely be used to map different
physical addresses</p></li>
<li><dl class="simple">
<dt><strong>Shared Memory</strong></dt><dd><ul>
<li><p>implemented with MMU, map the same physical frame into two different processes</p></li>
<li><p>virtual addresses do not need to be same</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Lazy Allocation</strong></dt><dd><ul>
<li><p>a performance optimisation, kernel waiting to allocate pages requested by a process
until the pages are actually used</p></li>
<li><p>kernel creates a request record in its page tables, and return to the process
without updating the TLB</p></li>
<li><p>page fault is generated when the newly allocated memory is touched</p></li>
<li><p>kernel validate the mapping, allocate a physical page frame, update the TLB, and
return from the page fault handler for the user-space program to resume</p></li>
<li><p>user-space program is never aware of the page fault</p></li>
<li><p>pre-fault pages at the start of execution for time-sensitive processes, e.g. <code class="docutils literal notranslate"><span class="pre">mlock()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="user-space-allocation">
<h3>User-Space Allocation<a class="headerlink" href="#user-space-allocation" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>mmap()</strong></dt><dd><ul>
<li><p>standard way to allocate large amount of memory, often used for files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MAP_ANONYMOUS</span></code> flag to allocate normal memory for the process</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MAP_SHARED</span></code> flag to share allocated pages with other processes</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>brk()/sbrk()</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">brk()</span></code>: sets the top of the program break, in effect increases the heap size</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sbrk()</span></code>: increases the program break</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">malloc()</span></code> and <code class="docutils literal notranslate"><span class="pre">calloc()</span></code> will use <code class="docutils literal notranslate"><span class="pre">brk()</span></code> or <code class="docutils literal notranslate"><span class="pre">mmap()</span></code> depending on the allocation size</p></li>
</ul>
</div></blockquote>
<p><a class="reference external" href="#linux">back to top</a></p>
</section>
</section>
<section id="kernel-development">
<h2>Kernel Development<a class="headerlink" href="#kernel-development" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#build-tools">Build Tools</a>, <a class="reference internal" href="#kernel-dependent-tools">Kernel Dependent Tools</a>, <a class="reference internal" href="#kernel-config">Kernel Config</a>, <a class="reference internal" href="#build-kernel">Build Kernel</a>, <a class="reference internal" href="#install-kernel">Install Kernel</a></p></li>
<li><p><a class="reference internal" href="#upgrade-kernel">Upgrade Kernel</a>, <a class="reference internal" href="#customise-kernel">Customise Kernel</a>, <a class="reference internal" href="#find-drivers">Find Drivers</a>, <a class="reference internal" href="#common-config">Common Config</a>, <a class="reference internal" href="#code-navigation">Code Navigation</a></p></li>
<li><p><a class="reference internal" href="#pie">PIE</a>, <a class="reference internal" href="#ffi">FFI</a></p></li>
<li><p>never build the kernel with root permissions enabled, and never do kernel development under
<code class="docutils literal notranslate"><span class="pre">/usr/src/</span></code> directory</p></li>
<li><p>multi-lib system requires compiling applications for both 32-bit and 64-bit</p></li>
<li><p>the source code has stable and development rc branches, and is available at [kernel.org](<a class="reference external" href="https://kernel.org/">https://kernel.org/</a>)</p></li>
</ul>
<section id="build-tools">
<h3>Build Tools<a class="headerlink" href="#build-tools" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>check <code class="docutils literal notranslate"><span class="pre">Documentation/Changes</span></code> to verify tools versions</p></li>
<li><dl class="simple">
<dt><strong>Compiler</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">gcc</span></code> C compiler is needed as the kernel is written in C</p></li>
<li><p>do not use the most recent gcc version to build the kernel, <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">--version</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Linker</strong></dt><dd><ul>
<li><p>tools from <code class="docutils literal notranslate"><span class="pre">binutils</span></code> to link and assemble source files, <code class="docutils literal notranslate"><span class="pre">ld</span> <span class="pre">-v</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Make</strong></dt><dd><ul>
<li><p>scan the kernel source tree for file that need to be compiled</p></li>
<li><p>recommended to use the latest stable version, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">--version</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="kernel-dependent-tools">
<h3>Kernel Dependent Tools<a class="headerlink" href="#kernel-dependent-tools" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>some packages need to be upgraded to work properly with the new kernel version</p></li>
<li><dl class="simple">
<dt><strong>util-linux</strong></dt><dd><ul>
<li><p>collection of small utilities, mostly to manipulate disk partitions and hardware
clock in the system</p></li>
<li><p>recommended for the latest version to support new features, <code class="docutils literal notranslate"><span class="pre">fdformat</span> <span class="pre">--version</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>module-init-tools</strong></dt><dd><ul>
<li><p>required to use kernel modules</p></li>
<li><p>recommended for the latest version to support new features, <code class="docutils literal notranslate"><span class="pre">depmod</span> <span class="pre">-V</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>File System Tools</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">e2fsprogs</span></code>: to manage ext2, ext3, and ext4 file systems, recommended latest version,
<code class="docutils literal notranslate"><span class="pre">tune2fs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jfsutils</span></code>: to use IBM JFS file system, <code class="docutils literal notranslate"><span class="pre">fsck.jfs</span> <span class="pre">-V</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reiserfsprogs</span></code>: to use ReiserFS file system, <code class="docutils literal notranslate"><span class="pre">reiserfsck</span> <span class="pre">-V</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xfsprogs</span></code>: to use XFS file system from SGI, <code class="docutils literal notranslate"><span class="pre">xfs_db</span> <span class="pre">-V</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quota-tools</span></code>: to use quota functionality of the kernel, <code class="docutils literal notranslate"><span class="pre">quota</span> <span class="pre">-V</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nfs-utils</span></code>: to use NFS file system, <code class="docutils literal notranslate"><span class="pre">showmount</span> <span class="pre">--version</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>udev</strong></dt><dd><ul>
<li><p>enable persistent and dynamic device-naming system in <code class="docutils literal notranslate"><span class="pre">/dev</span></code></p></li>
<li><p>almost all Linux distributions use <code class="docutils literal notranslate"><span class="pre">udev</span></code> to manage <code class="docutils literal notranslate"><span class="pre">/dev</span></code> directory</p></li>
<li><p>recommended to use latest or distribution provided version, <code class="docutils literal notranslate"><span class="pre">udevadm</span> <span class="pre">-V</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>procps</strong></dt><dd><ul>
<li><p>include commonly used tools such as <code class="docutils literal notranslate"><span class="pre">ps</span></code> and <code class="docutils literal notranslate"><span class="pre">top</span></code>, <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">--version</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>pcmciautils</strong></dt><dd><ul>
<li><p>user-space helper program to properly use PCMCIA devices</p></li>
<li><p>recommended for the latest version, <code class="docutils literal notranslate"><span class="pre">pccardctl</span> <span class="pre">-V</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="kernel-config">
<h3>Kernel Config<a class="headerlink" href="#kernel-config" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>configure kernel options with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">config</span></code> by choosing every options, or can be based on
a pre-built configuration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.config</span></code> file is generated in the top directory</p></li>
<li><dl class="simple">
<dt><strong>Default Config</strong></dt><dd><ul>
<li><p>based on defaults by kernel maintainer, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">defconfig</span></code></p></li>
<li><p>usually the configuration the maintainer use for personal machines</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Interactive Config Tool</strong></dt><dd><ul>
<li><p>Menuconfig: terminal based, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code></p></li>
<li><p>Gconfig: GTK+ based</p></li>
<li><p>Xconfig: QT based</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>check advanced build options in <code class="docutils literal notranslate"><span class="pre">Documentation/kbuild</span></code> directory</p></li>
</ul>
</div></blockquote>
</section>
<section id="build-kernel">
<h3>Build Kernel<a class="headerlink" href="#build-kernel" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>after setting config options, use <code class="docutils literal notranslate"><span class="pre">make</span></code> to build the kernel</p></li>
<li><p>can specify directory of the built files with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">O=/dir/for/output</span></code>, config file also
need to be placed in that directory, <cite>make O=/dir/for/output defconfig</cite></p></li>
<li><dl class="simple">
<dt><strong>Multithread Build</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-jX</span></code> with X being twice the number of processors in the system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j</span></code> without value will create a new thread for every subdirectory</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Partial Build</strong></dt><dd><ul>
<li><p>can build a specific subdirectory or a single file within the kernel tree</p></li>
<li><p>e.g. <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">drivers/usb/serial</span></code> will build the files in that directory, but will not
build the final module images</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">M=drivers/usb/serial</span></code> to build all necessary files and link the final
module images</p></li>
<li><p>run <code class="docutils literal notranslate"><span class="pre">make</span></code> again to affect the changes in the subdirectory to the final kernel image</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">drivers/usb/serial/visor.ko</span></code> to build specific file, and do final link to
create the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Cross Compliation</strong></dt><dd><ul>
<li><p>using more powerful machine to build for a smaller embedded system</p></li>
<li><p>specify architecture with <code class="docutils literal notranslate"><span class="pre">ARCH=</span></code>, C compiler with <code class="docutils literal notranslate"><span class="pre">CC=</span></code>, and cross-compile
toolchain with <code class="docutils literal notranslate"><span class="pre">CORSS_COMPILE=</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ARCH=arm</span> <span class="pre">CROSS_COMPILE=/usr/local/bin/arm-linux</span></code> to build with ARM toolchain</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">CC=&quot;ccache</span> <span class="pre">gcc&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">CC=&quot;ccache</span> <span class="pre">distcc&quot;</span></code> to change compiler for the build
system</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="install-kernel">
<h3>Install Kernel<a class="headerlink" href="#install-kernel" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>Auto Install</strong></dt><dd><ul>
<li><p>can use distro based <code class="docutils literal notranslate"><span class="pre">installkernel</span></code> to auto install a built kernel and modify
bootloader</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">modules_install</span></code> to install if there are any modules built, and install the
main kernel with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code></p></li>
<li><p>module files will be placed in <code class="docutils literal notranslate"><span class="pre">/lib/modules/KERNEL_VERSION</span></code></p></li>
<li><p>during installation, kernel is verified, static kernel is placed in <code class="docutils literal notranslate"><span class="pre">/boot</span></code>, required
initial ramdisk images are created, and bootloader is updated</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Manual Install</strong></dt><dd><ul>
<li><p>install modules with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">modules_install</span></code>, and run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">kernelversion</span></code> to know
the version</p></li>
<li><p>run <code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">arch/x86/boot/bzImage</span> <span class="pre">/boot/bzImage-KERNEL_VERSION</span></code>, and
<code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">System.map</span> <span class="pre">/boot/System.map-KERNEL_VERSION</span></code> to copy static kernel image</p></li>
<li><p>modify the bootloader, such as GRUB, LILO</p></li>
<li><p>can run <code class="docutils literal notranslate"><span class="pre">info</span> <span class="pre">grub</span></code> to get more info</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="upgrade-kernel">
<h3>Upgrade Kernel<a class="headerlink" href="#upgrade-kernel" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>can update the kernel while retaining configurations, always backup <code class="docutils literal notranslate"><span class="pre">.config</span></code> file</p></li>
<li><p>get the source code to upgrade, reconfigure it based on the previous kernel config, build
and install the new kernel</p></li>
<li><dl class="simple">
<dt><strong>Kernel Patch</strong></dt><dd><ul>
<li><p>Stable Patches: apply to the base kernel version, e.g. 2.6.17.9 patch only apply to
2.6.17 release</p></li>
<li><p>Base Patches: apply to the previous base kernel version, e.g. 2.6.18 patch only
apply to 2.6.17</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">patch</span> <span class="pre">-p1</span> <span class="pre">&lt;</span> <span class="pre">PATCH_FILE</span></code> in the kernel directory to apply the patch</p></li>
<li><p>check the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> or run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">kernelversion</span></code> to check if the patch is applied</p></li>
<li><p>to upgrade more than two versions, downgrade and upgrade to desired version save steps,
e.g. go from 2.6.17.9 to 2.6.17, and then upgrade to 2.6.17.11</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">oldconfig</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">silentoldconfig</span></code> to update new configurations</p></li>
<li><p>upgrades between stable releases rarely have new configuration options</p></li>
</ul>
</div></blockquote>
</section>
<section id="customise-kernel">
<h3>Customise Kernel<a class="headerlink" href="#customise-kernel" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>can check distribution’s kernel configuration to know which modules are necessary</p></li>
<li><p>distribution kernel files can be found under <code class="docutils literal notranslate"><span class="pre">/usr/src</span></code>, and config file can be found at
<code class="docutils literal notranslate"><span class="pre">/proc/config.gz</span></code> or <code class="docutils literal notranslate"><span class="pre">/boot/config-$(uname</span> <span class="pre">-r)</span></code></p></li>
<li><p>only disable options that are certain not needed</p></li>
<li><dl class="simple">
<dt><strong>sysfs</strong></dt><dd><ul>
<li><p>virtual file system with symlinks to all around the file system, should always be
mounted at <code class="docutils literal notranslate"><span class="pre">/sys</span></code></p></li>
<li><p>internal structure usually changes due to reorganisation of devices</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Device Discovery</strong></dt><dd><ul>
<li><p>need to find proper <code class="docutils literal notranslate"><span class="pre">sysfs</span></code> class device that the device is bound to</p></li>
<li><p>e.g. use <code class="docutils literal notranslate"><span class="pre">basename</span> <span class="pre">$(readlink</span> <span class="pre">/sys/class/net/eth0/device/driver/module)</span></code> to trace
through <code class="docutils literal notranslate"><span class="pre">sysfs</span></code> tree to find out which module is controlling it</p></li>
<li><p>in the kernel source, use <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">-type</span> <span class="pre">f</span> <span class="pre">-name</span> <span class="pre">Makefile</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">grep</span> <span class="pre">MODULE_NAME</span></code> to
find the config options for the module</p></li>
<li><p>any output from the find command that has <code class="docutils literal notranslate"><span class="pre">CONFIG_</span></code> need to be enabled to build the
module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="find-drivers">
<h3>Find Drivers<a class="headerlink" href="#find-drivers" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>all kernel modules have internal list of devices they support that is auto generated
by the list of devices the driver tells the kernel it supports</p></li>
<li><p>easiest way find which driver control which device is to build all the drivers and let
<code class="docutils literal notranslate"><span class="pre">udev</span></code> startup process match the driver to the device</p></li>
<li><dl class="simple">
<dt><strong>for PCI Devices</strong></dt><dd><ul>
<li><p>known by vendor ID and device ID, use <code class="docutils literal notranslate"><span class="pre">lspci</span></code> to list all PCI devices in the format
<code class="docutils literal notranslate"><span class="pre">&lt;BUS_ID:DEVICE_ID.FUNCTION_ID&gt;</span> <span class="pre">&lt;CLASS&gt;:</span> <span class="pre">&lt;VENDOR&gt;</span> <span class="pre">&lt;DEVICE&gt;</span> <span class="pre">(rev</span> <span class="pre">REVISION_IN_HEX)</span></code></p></li>
<li><p>check <code class="docutils literal notranslate"><span class="pre">/sys/bus/pci/devices/0000:&lt;BUS_ID:DEVICE_ID.FUNCTION_ID&gt;</span></code> for <code class="docutils literal notranslate"><span class="pre">vendor</span></code> and
<code class="docutils literal notranslate"><span class="pre">device</span></code> files</p></li>
<li><p>in kernel source directory, search vendor definition with
<code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-i</span> <span class="pre">&lt;VENDOR_ID&gt;</span> <span class="pre">include/linux/pci_ids.h</span></code>, and driver source files with
<code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-Rl</span> <span class="pre">&lt;VENDOR_DEF&gt;</span> <span class="pre">*</span></code></p></li>
<li><p>PCI drivers contain a list of supported devices in <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">pci_device_id</span></code>, and match
the vendor and device ID to check if it supports</p></li>
<li><p>search the Makefiles with <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">-type</span> <span class="pre">f</span> <span class="pre">-name</span> <span class="pre">Makefile</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">grep</span> <span class="pre">DRIVER_NAME</span></code> for
<code class="docutils literal notranslate"><span class="pre">CONFIG_</span></code> to build the driver</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>for USB Devices</strong></dt><dd><ul>
<li><p>use <code class="docutils literal notranslate"><span class="pre">lsusb</span></code> to list USB devices in the format of
<code class="docutils literal notranslate"><span class="pre">Bus</span> <span class="pre">&lt;BUS_ID&gt;</span> <span class="pre">Device</span> <span class="pre">&lt;DEVICE_ID&gt;:</span> <span class="pre">ID</span> <span class="pre">&lt;VENDOR_ID&gt;:&lt;PRODUCT_ID&gt;</span> <span class="pre">&lt;VENDOR&gt;</span> <span class="pre">&lt;PRODUCT&gt;</span></code></p></li>
<li><p>USB device numbers change every time it is plugged in, only vendor and product ID
are unique</p></li>
<li><p>in kernel source directory, search with <code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-i</span> <span class="pre">-R</span> <span class="pre">-l</span> <span class="pre">&lt;VENDOR_ID&gt;</span> <span class="pre">drivers/*</span></code> for
vendor definition</p></li>
<li><p>USB drivers have a list of supported devices in <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">usb_device_id</span></code></p></li>
<li><p>search the Makefiles with <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">-type</span> <span class="pre">f</span> <span class="pre">-name</span> <span class="pre">Makefile</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">grep</span> <span class="pre">DRIVER_NAME</span></code> for
<code class="docutils literal notranslate"><span class="pre">CONFIG_</span></code> to build the driver</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>for Root File System</strong></dt><dd><ul>
<li><p>contain all initial programs, and usually entire system config</p></li>
<li><p>the kernel must be able to find the root file system at boot time</p></li>
<li><p>recommended to build file system for root partition, and disk controller for the
disk, and use ramdisk image at boot time</p></li>
<li><p>determine the file system type with <code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&quot;</span> <span class="pre">/</span> <span class="pre">&quot;</span></code>, and check block devices with
<code class="docutils literal notranslate"><span class="pre">tree</span> <span class="pre">-d</span> <span class="pre">/sys/block</span> <span class="pre">|</span> <span class="pre">egrep</span> <span class="pre">&quot;hd|sd&quot;</span></code></p></li>
<li><p>disk partitions are numbered, but main block devices are not</p></li>
<li><p>the whole main block device must be configured to access the individual partitions</p></li>
<li><p>go up a chain of devices through the symlink of <code class="docutils literal notranslate"><span class="pre">/sys/block/&lt;BLOCK_DEVICE&gt;</span></code>, and find
the necessary drivers</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>for Disk Controller</strong></dt><dd><ul>
<li><p>e.g. <code class="docutils literal notranslate"><span class="pre">/sys/block/sdb</span></code> will symlink to some <code class="docutils literal notranslate"><span class="pre">/sys/devices/&lt;SOMETHING_LONG&gt;/block/sdb</span></code></p></li>
<li><p>go up the link and take note of the disk controller driver in
<code class="docutils literal notranslate"><span class="pre">/sys/devices/&lt;SOMETHING_LESS_LONG&gt;/target0:0:0/0:0:0:0</span></code></p></li>
<li><p>go up and find another driver, e.g. <code class="docutils literal notranslate"><span class="pre">/sys/devices/pci&lt;SOMETHING&gt;/0000:&lt;SOMETHING&gt;</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>enable the necessary file system type driver and disk controller drivers in kernel config</p></li>
</ul>
</div></blockquote>
</section>
<section id="common-config">
<h3>Common Config<a class="headerlink" href="#common-config" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>Disks</strong></dt><dd><ul>
<li><p>most USB storage devices need SCSI subsystem, SCSI disk support, and USB storage
support</p></li>
<li><p>IDE disks need PCI support, IDE subsystem, IDE support, generic IDE controller for
ATA system, and PCI IDE controllers</p></li>
<li><p>SATA disks use <code class="docutils literal notranslate"><span class="pre">libata</span></code>, and need PCI support, SCSI subsystem, SCSI disk support,
SCSI low-level drivers of specific SATA controller type</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>CD-ROM</strong></dt><dd><ul>
<li><p>IDE CD-ROM drives need the same as IDE disks, and additional IDE CD-ROM support</p></li>
<li><p>SCSI and SATA CD-ROM  drives need the same as SATA or SCSI disks, and additional
SCSI CD-ROM support</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Devices</strong></dt><dd><ul>
<li><p>USB controllers need PCI support, USB support, USB host controllers, and specific
USB device driver</p></li>
<li><p>IEEE 1394 FireWire need PCI support, IEEE 1394 support, specific FireWire host
controller and device support</p></li>
<li><p>PCI hotplug such as ExpressCard need PCI support, PCI hotplug support, ACPI
controller for most types, and PCI express controller</p></li>
<li><p>PCMCIA and CardBus need PCI support, PCCARD support, PCMCIA or CardBus device
support, and card bridge support</p></li>
<li><p>Sound system need basic sound support, ALSA support, base ALSA options, and specific
sound device support</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>CPU</strong></dt><dd><ul>
<li><p>Processor need sub-architecture type, and processor family type, can use Generic
architecture options to run on all types of machines</p></li>
<li><p>for multicore CPUs, SMP option should be enabled</p></li>
<li><p>Preemption model can be changed, such as using main internal kernel locks</p></li>
<li><p>can enable kernel Suspend mode, with the option to specify resume or not</p></li>
<li><p>CPU frequency scaling need basic frequency scaling support, frequency governors with
one default based on the processor type</p></li>
<li><p>for 32-bit Intel CPU, there are three different memory models</p></li>
<li><p>ACPI need ACPI support, and specific drivers to control ACPI devices</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Networking</strong></dt><dd><ul>
<li><p>all network options need main Networking support, with TCP/IP option</p></li>
<li><p>Netfilter need Network packet filtering, with Netfilter netlink interface and
Xtables support, and protocols to filter</p></li>
<li><p>Ethernet need PCI support, basic network device support,and specific device drivers</p></li>
<li><p>IrDA need IrDA subsystem, IrDA protocols, and IrDA device support</p></li>
<li><p>Bluetooth need Bluetooth subsystem, protocols, and specific device drivers</p></li>
<li><p>Wireless network need IEEE 802.11 option, protocols, and PCI or USB device driver
options</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>File System</strong></dt><dd><ul>
<li><p>hardware RAID is handled by the disk controller without help from the kernel</p></li>
<li><p>software RAID need Multiple devices driver support, RAID support with at least one
RAID configuration</p></li>
<li><p>LVM need Multiple devices driver support, Device mapper support with helper modules</p></li>
<li><p>SMB, CIFS, and OCFS2 file systems need respective system support</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Security</strong></dt><dd><ul>
<li><p>different security models and default linux capabilities should be enabled</p></li>
<li><p>SELinux need network option, Auditing support, Socket and Networking Security Hooks,
and NSA SELinux support, along with various SELinux options</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Debugging</strong></dt><dd><ul>
<li><p>timestamp options can be enabled on kernel messages</p></li>
<li><p>Magic SysRq key can trigger different actions, check
<code class="docutils literal notranslate"><span class="pre">Documentation/admin-guide/sysrq.rst</span></code> in kernel source for more information</p></li>
<li><p>debugfs can be enabled and mounted at <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug</span></code> directory</p></li>
<li><p>enabling many different kernel debugging options may help kernel developers, but
decrease performance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="code-navigation">
<h3>Code Navigation<a class="headerlink" href="#code-navigation" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>to use with cscope and ctags, run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">tags</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">cscope</span></code></p></li>
<li><p>to use with LSP, run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">scripts/clang-tools/gen_compile_commands.py</span></code>, pass <code class="docutils literal notranslate"><span class="pre">--help</span></code>
argument for more info</p></li>
</ul>
</div></blockquote>
</section>
<section id="pie">
<h3>PIE<a class="headerlink" href="#pie" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Position-Independent Executables, can be loaded anywhere in memory</p></li>
<li><p>ASLR: Address Space Layout Randomisation, security feature that mitigates some attacks
based on fixed addresses</p></li>
<li><p>without PIE, ASLR can be applied for shared libraries, but not for executables</p></li>
<li><p>SSP: Stack Smashing Protection, to ensure the parameter stack is not corrupted</p></li>
<li><p>stack corruption can alter the return address of a function, transferring control to
malicious code</p></li>
</ul>
</div></blockquote>
</section>
<section id="ffi">
<h3>FFI<a class="headerlink" href="#ffi" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Foreign Function Interface, allows a program written in one language to call a program in
another language</p></li>
<li><p>Libffi provides to call functions specified by a call interface description at run time,</p></li>
<li><p>it also provides a bridge between interpreters such as Perl, Python and shared library
subroutines in C or C++</p></li>
</ul>
</div></blockquote>
<p><a class="reference external" href="#linux">back to top</a></p>
</section>
</section>
<section id="kernel-data-structures">
<h2>Kernel Data Structures<a class="headerlink" href="#kernel-data-structures" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#file-operations">File Operations</a>, <a class="reference internal" href="#inode">Inode</a></p></li>
</ul>
<section id="file-operations">
<h3>File Operations<a class="headerlink" href="#file-operations" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file_operations</span></code> defined in <code class="docutils literal notranslate"><span class="pre">&lt;linux/fs.h&gt;</span></code></p></li>
<li><p>a collection of function pointers, and set up the connection between device numbers and
device driver’s operations</p></li>
<li><p>mostly implement system calls such as <code class="docutils literal notranslate"><span class="pre">open</span></code>, <code class="docutils literal notranslate"><span class="pre">read</span></code>, etc., and unsupported operations
must be left <cite>NULL</cite></p></li>
<li><p>each open file is an object associated with its own methods through <code class="docutils literal notranslate"><span class="pre">f_op</span></code> pointer, OOP
concept</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">__user</span> <span class="pre">*</span></code> in the methods means a pointer to user-space address that cannot be
directly dereferenced</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__user</span></code> has no effect for normal compilation, but can be used to find misuse of
user-space addresses</p></li>
<li><dl class="simple">
<dt><strong>``struct module *owner``</strong></dt><dd><ul>
<li><p>pointer to the module that owns the structure</p></li>
<li><p>used to prevent the module being unloaded while operations are in use</p></li>
<li><p>almost always initialised to <code class="docutils literal notranslate"><span class="pre">THIS_MODULE</span></code> in <code class="docutils literal notranslate"><span class="pre">&lt;linux/module.h&gt;</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``loff_t (*llseek) (struct file *, loff_t, int)``</strong></dt><dd><ul>
<li><p>to change current read write position in a file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loff_t</span></code>: long offset with at least 64 bits wide even on 32-bit platforms</p></li>
<li><p>NULL method will modify the position counter in the <code class="docutils literal notranslate"><span class="pre">file</span></code> structure</p></li>
<li><p>positive return value for success, and negative on errors</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``ssize_t (*read) (struct file *, char __user *, size_t, loff_t *)``</strong></dt><dd><ul>
<li><p>to retrieve data from the device, NULL method will fail with <code class="docutils literal notranslate"><span class="pre">-EINVAL</span></code></p></li>
<li><p>return number of bytes read on success</p></li>
<li><p>called by read(2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``ssize_t (*read_iter) (struct kiocb *, struct iov_iter *)``</strong></dt><dd><ul>
<li><p>possibly async read with <code class="docutils literal notranslate"><span class="pre">iov_iter</span></code> as source</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``ssize_t (*write) (struct file *, const char __user *, size_t, loff_t *)``</strong></dt><dd><ul>
<li><p>send data to the device, <code class="docutils literal notranslate"><span class="pre">-EINVAL</span></code> for NULL method</p></li>
<li><p>return number of bytes written on success</p></li>
<li><p>called by write(2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``int (*iterate_shared) (struct file *, struct dir_context *)``</strong></dt><dd><ul>
<li><p>to read directory contents, should be NULL method for device files</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``__poll_t (*poll) (struct file *, struct poll_table_struct *)``</strong></dt><dd><ul>
<li><p>check activity on the file, and can go to sleep until I/O</p></li>
<li><p>return a bit mask to indicate non-blocking read/write is possible</p></li>
<li><p>NULL method means the device is readable and writable without blocking</p></li>
<li><p>called by select(2) and poll(2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``long (*unlocked_ioctl) (struct file *, unsinged int, unsinged long)``</strong></dt><dd><ul>
<li><p>to call device-specific commands</p></li>
<li><p>called by ioctl(2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``int (*mmap) (struct file *, struct vm_area_struct *)``</strong></dt><dd><ul>
<li><p>to request a mapping of device memory to a process address space</p></li>
<li><p>NULL method will return <code class="docutils literal notranslate"><span class="pre">-ENODEV</span></code></p></li>
<li><p>called by mmap(2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``int (*open) (struct inode *, struct file *)``</strong></dt><dd><ul>
<li><p>to open an inode, and create a new <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span></code>, driver is not required to declare
the method</p></li>
<li><p>good place to initialise <code class="docutils literal notranslate"><span class="pre">file-&gt;private_data</span></code> to point to a device structure</p></li>
<li><p>NULL method always succeed opening the device, but driver is not notified</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``int (*flush) (struct file *, fl_ownder_t id)``</strong></dt><dd><ul>
<li><p>to close a process copy of a file descriptor for a device, used in very few drivers</p></li>
<li><p>should wait for any outstanding device operations</p></li>
<li><p>NULL method will ignore the user application request</p></li>
<li><p>called by close(2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``int (*release) (struct inode *, struct file *)``</strong></dt><dd><ul>
<li><p>called when the last reference to an open file is closed, can be NULL like <code class="docutils literal notranslate"><span class="pre">open()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``int (*fsync) (struct file *, loff_t, loff_t, int datasync)``</strong></dt><dd><ul>
<li><p>to flush any pending data, NULL method return <code class="docutils literal notranslate"><span class="pre">-EINVAL</span></code></p></li>
<li><p>called by fsync(2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``int (*fasync) (int, struct file *, int)``</strong></dt><dd><ul>
<li><p>to notify the device of <code class="docutils literal notranslate"><span class="pre">FASYNC</span></code> flag change</p></li>
<li><p>can be NULL method if the driver does not support async notification</p></li>
<li><p>called by fcntl(2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``int (*lock) (struct file *, int, struct file_lock *)``</strong></dt><dd><ul>
<li><p>for file locking, necessary for regular files but not required by device drivers</p></li>
<li><p>called by fcntl(2) for <code class="docutils literal notranslate"><span class="pre">F_GETLK,</span> <span class="pre">F_SETLK,</span> <span class="pre">F_SETLKW</span></code> commands</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``unsigned long (*get_unmapped_area) (struct file *, unsigned long, unsinged long, unsinged long, unsinged long)``</strong></dt><dd><ul>
<li><p>to find a location in process address space to map in a device memory, usually done
by memory management code</p></li>
<li><p>drivers can implement to enforce alignment requirements, most drivers can have NULL
method</p></li>
<li><p>called by mmap(2)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>``int (*check_flags) (int)``</strong></dt><dd><ul>
<li><p>allow a module to check the flags passed to fcntl</p></li>
<li><p>called by fcntl(2) for <code class="docutils literal notranslate"><span class="pre">F_SETFL</span></code> command</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="inode">
<h3>Inode<a class="headerlink" href="#inode" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>helps file systems keep track of data, and contains metadata about a file</p></li>
</ul>
</div></blockquote>
<p><a class="reference external" href="#linux">back to top</a></p>
</section>
</section>
<section id="kernel-modules">
<h2>Kernel Modules<a class="headerlink" href="#kernel-modules" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#kernel-role">Kernel Role</a>, <a class="reference internal" href="#device-and-module-classes">Device and Module Classes</a>, <a class="reference internal" href="#protection-levels">Protection Levels</a>, <a class="reference internal" href="#compile-and-load-modules">Compile and Load Modules</a></p></li>
<li><p><a class="reference internal" href="#current-process">Current Process</a>, <a class="reference internal" href="#module-stacking">Module Stacking</a>, <a class="reference internal" href="#module-conventions">Module Conventions</a>, <a class="reference internal" href="#module-functions">Module Functions</a>, <a class="reference internal" href="#module-parameters">Module Parameters</a></p></li>
<li><p><a class="reference internal" href="#pam">PAM</a></p></li>
</ul>
<section id="kernel-role">
<h3>Kernel Role<a class="headerlink" href="#kernel-role" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>Process Management</strong></dt><dd><ul>
<li><p>create, destroy, and handle processes I/O connection</p></li>
<li><p>process communication can be through signals, pipes, or interprocess communication</p></li>
<li><p>the scheduler is part of process management</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Memory Management</strong></dt><dd><ul>
<li><p>kernel builds virtual address space on limited available resources</p></li>
<li><p>different parts of kernel interact with memory management subsystem</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>File System</strong></dt><dd><ul>
<li><p>kernel builds structured file system on top of unstructured hardware</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Device Control</strong></dt><dd><ul>
<li><p>almost every system operation maps to a physical device</p></li>
<li><p>device drivers perform any device control operations</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Networking</strong></dt><dd><ul>
<li><p>network operations must be managed by the OS as they are not specific to a process</p></li>
<li><p>routing and address resolution issues are implemented in the kernel</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="device-and-module-classes">
<h3>Device and Module Classes<a class="headerlink" href="#device-and-module-classes" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>Module</strong></dt><dd><ul>
<li><p>functionality that can be added or removed from a kernel at runtime</p></li>
<li><p>a module is an object code that can be dynamically linked with <code class="docutils literal notranslate"><span class="pre">insmod</span></code> or unlinked
with <code class="docutils literal notranslate"><span class="pre">rmmod</span></code></p></li>
<li><p>a module is linked to the kernel, and can only call functions exported by the kernel</p></li>
<li><p>each module implements char module, block module or network module</p></li>
<li><p>every kernel module is event-driven</p></li>
<li><p>a module’s initialisation function terminates immediately, and exit function is
called just before it is unloaded</p></li>
<li><p>the exit function must undo everything the init function did</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Character Device</strong></dt><dd><ul>
<li><p>can be accessed as a stream of bytes, and by means of file system nodes, e.g.
<code class="docutils literal notranslate"><span class="pre">/dev/tty1</span></code></p></li>
<li><p>char driver implements at least <code class="docutils literal notranslate"><span class="pre">open</span></code>, <code class="docutils literal notranslate"><span class="pre">close</span></code>, <code class="docutils literal notranslate"><span class="pre">read</span></code>, and <code class="docutils literal notranslate"><span class="pre">write</span></code> system calls</p></li>
<li><p>most char devices can only be accessed sequentially, cannot move back and forth like
in regular file</p></li>
<li><p>but char devices that look like data areas, such as frame grabbers, use <code class="docutils literal notranslate"><span class="pre">mmap()</span></code> or
<code class="docutils literal notranslate"><span class="pre">lseek()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Block Device</strong></dt><dd><ul>
<li><p>can host a file system, and accessed by file system nodes in <code class="docutils literal notranslate"><span class="pre">/dev</span></code></p></li>
<li><p>Linux allows read and write to a block device like a char device, by permitting the
transfer of any number of bytes at a time</p></li>
<li><p>block and char devices differ only how data is managed internally, and block drivers
have different interface to the kernel than char drivers</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Network Interface</strong></dt><dd><ul>
<li><p>a network driver only handles data packets without connection details</p></li>
<li><p>a network device is not stream-oriented, and the interface is not mapped to a node
in the file system</p></li>
<li><p>communication for kernel and network driver is different from char and block drivers</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>file system type is just a software driver, as it maps low-level data structures to
high-level ones, and is independent of actual data transfer to and from the disk</p></li>
</ul>
</div></blockquote>
</section>
<section id="protection-levels">
<h3>Protection Levels<a class="headerlink" href="#protection-levels" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>modern CPUs enforces protection of system software from applications, and have at least
two protection levels</p></li>
<li><p>in processors with several levels, such as x86, the highest, kernel space or supervisor
mode, and lowest, user-space, levels are used</p></li>
<li><p>each mode can have its own address space or memory mapping</p></li>
<li><p>execution transfers from user-space to kernel space whenever an application makes a
system call or is suspended by hardware interrupt</p></li>
<li><p>interrupt handling code is running in the process context, async, and not related to any
particular process</p></li>
</ul>
</div></blockquote>
</section>
<section id="current-process">
<h3>Current Process<a class="headerlink" href="#current-process" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>the process that invokes the system call, global item defined in <code class="docutils literal notranslate"><span class="pre">&lt;asm/current.h&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">current</span></code> is a pointer to <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">task_struct</span></code> defined by <code class="docutils literal notranslate"><span class="pre">&lt;linux/sched.h&gt;</span></code></p></li>
<li><p>can access <code class="docutils literal notranslate"><span class="pre">current-&gt;pid</span></code>, <code class="docutils literal notranslate"><span class="pre">current-&gt;comm</span></code>, and others</p></li>
</ul>
</div></blockquote>
</section>
<section id="compile-and-load-modules">
<h3>Compile and Load Modules<a class="headerlink" href="#compile-and-load-modules" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>can check <code class="docutils literal notranslate"><span class="pre">Documentation/kbuild</span></code> directory in kernel source for detailed information</p></li>
<li><p>ensure correct versions of compiler, module utilities, and necessary tools</p></li>
<li><p>a module need to be recompiled for each version of the kernel that it is linked to</p></li>
<li><p>need to use macros and <code class="docutils literal notranslate"><span class="pre">#ifdef</span></code> to make module code work with multiple kernel versions</p></li>
<li><dl class="simple">
<dt><strong>Makefile</strong></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">obj-m</span> <span class="pre">:=</span> <span class="pre">module.o</span></code> is to build a module from <code class="docutils literal notranslate"><span class="pre">module.o</span></code> object file</p></li>
<li><p>add <code class="docutils literal notranslate"><span class="pre">module-objs</span> <span class="pre">:=</span> <span class="pre">file1.o</span> <span class="pre">file2.o</span></code> if <code class="docutils literal notranslate"><span class="pre">module.ko</span></code> needs to be generated from two
source files</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>invoke <code class="docutils literal notranslate"><span class="pre">make</span></code> command within the context of kernel build system with
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-C</span> <span class="pre">KDIR</span> <span class="pre">M=MODULE_SOURCE</span> <span class="pre">modules</span></code></p></li>
<li><dl class="simple">
<dt><strong>insmod</strong></dt><dd><ul>
<li><p>load modules, and can assign module parameter values before linking to the kernel</p></li>
<li><p>correctly designed module can be configured at load time</p></li>
<li><p>can fail with unresolved symbols</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>modprobe</strong></dt><dd><ul>
<li><p>check if a module references symbols that are not currently defined in the kernel</p></li>
<li><p>look for other modules that define the symbols, and load them into the kernel</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>rmmod</strong></dt><dd><ul>
<li><p>remove modules, fail if the module is in use, or kernel disallow module removal</p></li>
<li><p>kernel can be configured to allow forced removal of modules</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>lsmod</strong></dt><dd><ul>
<li><p>list currently loaded modules by reading the <code class="docutils literal notranslate"><span class="pre">/proc/modules</span></code> virtual file</p></li>
<li><p>also provide additional information such as modules using other modules</p></li>
<li><p>currently loaded modules can also be found in <code class="docutils literal notranslate"><span class="pre">/sys/module</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="module-stacking">
<h3>Module Stacking<a class="headerlink" href="#module-stacking" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>other modules using the exported symbols, useful in complex projects</p></li>
<li><p>symbols exported by the loaded module become part of the kernel symbol table</p></li>
<li><p>one <code class="docutils literal notranslate"><span class="pre">modprobe</span></code> command can sometimes replace several invocations of <code class="docutils literal notranslate"><span class="pre">insmod</span></code></p></li>
<li><p>stacking can split modules into multiple layers and reduce development time</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">EXPORT_SYMBOL</span></code> and <code class="docutils literal notranslate"><span class="pre">EXPORT_SYMBOL_GPL</span></code> macros to export symbols for other modules,
the latter macro makes the symbol available to GPL-licensed modules only</p></li>
</ul>
</div></blockquote>
</section>
<section id="module-conventions">
<h3>Module Conventions<a class="headerlink" href="#module-conventions" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Mechanism: what capabilities are provided, Policy: how provided capabilities can be used</p></li>
<li><p>write kernel code to access the hardware, but do not force policies on user, and avoid
having security policy in the code</p></li>
<li><p>a driver only makes hardware available, how it is used to applications should be ignored</p></li>
<li><p>make policy only when necessary, e.g. digital I/O driver may only offer byte-wide access</p></li>
<li><p>different drivers can offer different capabilities for the same device</p></li>
<li><p>decomposition, different module for each new functionality, allows scalability and
extendability</p></li>
<li><p>kernel code must be reentrant, running in more than one context at the same time</p></li>
<li><p>the kernel stack can be as small as a single 4096 byte page</p></li>
<li><p>never declare large automatic variables, use dynamic allocation at call time if necessary</p></li>
<li><p>kernel API functions starting with double underscore are generally low-level component,
and should be used with caution</p></li>
<li><p>kernel code cannot do floating point arithmetic, as it would need the kernel to save and
restore the floating point processor’s state on entry and exit from kernel space</p></li>
<li><dl class="simple">
<dt><strong>Headers</strong></dt><dd><ul>
<li><p>most kernel code includes a large number of header files</p></li>
<li><p>about all module code has <code class="docutils literal notranslate"><span class="pre">&lt;linux/module.h&gt;</span></code>, for symbols and functions needed by
modules, and <code class="docutils literal notranslate"><span class="pre">&lt;linux/init.h&gt;</span></code>, to specify initialisation and cleanup functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;linux/sched.h&gt;</span></code> contains definitions of kernel API used by drivers</p></li>
<li><p>most also include <code class="docutils literal notranslate"><span class="pre">&lt;linux/moduleparam.h&gt;</span></code> to enable parameter passing to the module at
load time</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>should specify which licence with <code class="docutils literal notranslate"><span class="pre">MODULE_LICENSE</span></code></p></li>
<li><p>definitions should be put at the end of the file, e.g. <code class="docutils literal notranslate"><span class="pre">MODULE_AUTHOR</span></code>,
<code class="docutils literal notranslate"><span class="pre">MODULE_DESCRIPTION</span></code>, <code class="docutils literal notranslate"><span class="pre">MODULE_VERSION</span></code>, <code class="docutils literal notranslate"><span class="pre">MODULE_ALIAS</span></code>, <code class="docutils literal notranslate"><span class="pre">MODULE_DEVICE_TABLE</span></code></p></li>
<li><p>use standard C tagged structure initialisation syntax for portability, and compact code</p></li>
</ul>
</div></blockquote>
</section>
<section id="module-functions">
<h3>Module Functions<a class="headerlink" href="#module-functions" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul>
<li><p>arguments passed to kernel registration functions are usually pointers</p></li>
<li><p>most registration functions are prefixed with <code class="docutils literal notranslate"><span class="pre">register_</span></code></p></li>
<li><dl>
<dt><strong>Initialisation</strong></dt><dd><ul class="simple">
<li><p>initialisation functions should be declared <code class="docutils literal notranslate"><span class="pre">static</span></code>, as they are not meant to be
visible outside specific file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__init</span></code> tells the kernel that the function is used only at initialisation time, and
is dropped after the module is loaded</p></li>
<li><p>can use <code class="docutils literal notranslate"><span class="pre">__initdata</span></code> for data used only during initialisation</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">__init</span><span class="w"> </span><span class="nf">init_function</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">init_function</span><span class="p">);</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><strong>Cleanup</strong></dt><dd><ul class="simple">
<li><p>every module requires a cleanup function, which unregisters interfaces and returns
all resources to the system before the module is removed</p></li>
<li><p>functions with <code class="docutils literal notranslate"><span class="pre">__exit</span></code> can be called only at module unload or system shutdown time</p></li>
<li><p>if module is built into kernel, or kernel disallow module unloading, functions with
<code class="docutils literal notranslate"><span class="pre">__exit</span></code> are discarded</p></li>
<li><p>a module without a cleanup function cannot be unloaded</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">__exit</span><span class="w"> </span><span class="nf">cleanup_function</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="n">module_exit</span><span class="p">(</span><span class="n">cleanup_function</span><span class="p">);</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><strong>Error Handling</strong></dt><dd><ul class="simple">
<li><p>module code must always check return values</p></li>
<li><p>module should continue to provide any capabilities it can after failing to register</p></li>
<li><p>modules that fail to load must undo any registration operations performed before
the failure by itself, since there is no per-module registry</p></li>
<li><p>the kernel will be in unstable state if the module does not unregister after failure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">goto</span></code> statements are useful for error recovery, but can be difficult to manage for
complex cases</p></li>
<li><p>can also track registered values, and call cleanup function in case of any error</p></li>
<li><p>error codes are negative and defined in <code class="docutils literal notranslate"><span class="pre">&lt;linux/errno.h&gt;</span></code></p></li>
<li><p>it is customary to unregister in reverse order used to register</p></li>
<li><p>cleanup function cannot be marked <code class="docutils literal notranslate"><span class="pre">__exit</span></code> when it is called by nonexit code</p></li>
<li><p>kernel will call the module before initialisation is completed</p></li>
<li><p>the code should be able to be called after first registration</p></li>
<li><p>it is possible that the kernel is using a registered facility, but the module’s
initialisation function fails after registering that facility</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">stuff_ok</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">__init</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

<span class="w">    </span><span class="n">item1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allocate</span><span class="p">(</span><span class="n">arg1</span><span class="p">);</span>
<span class="w">    </span><span class="n">item2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allocate</span><span class="p">(</span><span class="n">arg2</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">item1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">item2</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">fail</span><span class="p">;</span>

<span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">register_stuff</span><span class="p">(</span><span class="n">item1</span><span class="p">,</span><span class="w"> </span><span class="n">item2</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">err</span><span class="p">)</span>
<span class="w">        </span><span class="n">stuff_ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">fail</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="nl">fail</span><span class="p">:</span>
<span class="w">    </span><span class="n">cleanup</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">item1</span><span class="p">)</span>
<span class="w">        </span><span class="n">release_thing</span><span class="p">(</span><span class="n">item1</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">item2</span><span class="p">)</span>
<span class="w">        </span><span class="n">release_thing</span><span class="p">(</span><span class="n">item2</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stuff_ok</span><span class="p">)</span>
<span class="w">        </span><span class="n">unregister_stuff</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="module-parameters">
<h3>Module Parameters<a class="headerlink" href="#module-parameters" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>parameter values can be assigned at load time by <code class="docutils literal notranslate"><span class="pre">insmod</span></code> or <code class="docutils literal notranslate"><span class="pre">modprobe</span></code></p></li>
<li><p>module must make parameters available by declaring with <code class="docutils literal notranslate"><span class="pre">module_param()</span></code> macro defined in
<code class="docutils literal notranslate"><span class="pre">&lt;linux/moduleparam.h&gt;</span></code></p></li>
<li><p>can also use <code class="docutils literal notranslate"><span class="pre">module_param_array()</span></code> to supply comma-separated list</p></li>
<li><p>all module parameters should have a default value</p></li>
<li><dl class="simple">
<dt><strong>Parameter Permission</strong></dt><dd><ul>
<li><p>use definitions from <code class="docutils literal notranslate"><span class="pre">&lt;linux/stat.h&gt;</span></code> for permission value in <code class="docutils literal notranslate"><span class="pre">module_param()</span></code></p></li>
<li><p>permission value controls access to representation of the module parameter in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code></p></li>
<li><p>no <code class="docutils literal notranslate"><span class="pre">sysfs</span></code> entry for 0 permission, and appears under <code class="docutils literal notranslate"><span class="pre">/sys/module</span></code> otherwise</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_IRUGO</span></code> allows read by everyone but cannot change</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_IRUGO</span> <span class="pre">|</span> <span class="pre">S_IWUSR</span></code> allows root to change</p></li>
<li><p>parameters should not be writable if there are no capabilities to detect the change
and react accordingly</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Available Types</strong></dt><dd><ul>
<li><p>byte, hexint, short, ushort, int, uint, long, ulong</p></li>
<li><p>charp: a character pointer</p></li>
<li><p>bool: a bool, values 0/1, y/n, Y/N.</p></li>
<li><p>invbool: the above, only sense-reversed (N = true).</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="pam">
<h3>PAM<a class="headerlink" href="#pam" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Pluggable Authentication Module can configure methods to authenticate users</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/etc/pam.d/</span></code>, configuration files for PAM</p></li>
<li><p>modules are loaded in order, but control field can change the order</p></li>
</ul>
</div></blockquote>
<p><a class="reference external" href="#linux">back to top</a></p>
</section>
</section>
<section id="device-drivers">
<h2>Device Drivers<a class="headerlink" href="#device-drivers" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#driver-components">Driver Components</a>, <a class="reference internal" href="#user-space-drivers">User-Space Drivers</a>, <a class="reference internal" href="#scull-driver">Scull Driver</a>, <a class="reference internal" href="#udev">Udev</a></p></li>
</ul>
<section id="driver-components">
<h3>Driver Components<a class="headerlink" href="#driver-components" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>driver code should register device number first</p></li>
<li><dl class="simple">
<dt><strong>Device Numbers</strong></dt><dd><ul>
<li><p>char devices are identified by <code class="docutils literal notranslate"><span class="pre">c</span></code> in the first column of <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span> <span class="pre">/dev</span></code> output, and block
devices by <code class="docutils literal notranslate"><span class="pre">b</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span> <span class="pre">/dev</span></code> also shows major and minor device number in the form of <code class="docutils literal notranslate"><span class="pre">MAJOR,</span> <span class="pre">MINOR</span></code></p></li>
<li><p>major number shows the driver associated with the device, and minor number is used
by the kernel to determine which device is being referred to</p></li>
<li><p>multiple drivers can share major numbers, but mostly one major to one driver</p></li>
<li><p>can get a direct pointer to the device from the kernel, or use the minor number as
an index into a local array of devices</p></li>
<li><p>32-bit <code class="docutils literal notranslate"><span class="pre">dev_t</span></code> type in <code class="docutils literal notranslate"><span class="pre">&lt;linux/types.h&gt;</span></code> has 12 bits for major and 20 bits for minor</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">MAJOR(dev_t</span> <span class="pre">dev)</span></code>, <code class="docutils literal notranslate"><span class="pre">MINOR(dev_t</span> <span class="pre">dev)</span></code>, and <code class="docutils literal notranslate"><span class="pre">MKDEV(int</span> <span class="pre">major,</span> <span class="pre">int</span> <span class="pre">minor)</span></code></p></li>
<li><p>need to get one or more device numbers when setting up a char device</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">register_chrdev_region()</span></code> defined in <code class="docutils literal notranslate"><span class="pre">&lt;linux/fs.h&gt;</span></code> if device numbers are known</p></li>
<li><p>new drivers should use dynamic allocation of major device number with
<code class="docutils literal notranslate"><span class="pre">alloc_chrdev_region()</span></code></p></li>
<li><p>always free the device numbers with <code class="docutils literal notranslate"><span class="pre">unregister_chrdev_region()</span></code>, usually in the
module cleanup function</p></li>
<li><p>common device numbers can be found in <code class="docutils literal notranslate"><span class="pre">Documentation/admin-guide/devices.txt</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>most driver operations need <code class="docutils literal notranslate"><span class="pre">file_operations</span></code>, <code class="docutils literal notranslate"><span class="pre">file</span></code>, and <code class="docutils literal notranslate"><span class="pre">inode</span></code> kernel data structures</p></li>
</ul>
</div></blockquote>
</section>
<section id="user-space-drivers">
<h3>User-Space Drivers<a class="headerlink" href="#user-space-drivers" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>useful when dealing with new and unusual hardware</p></li>
<li><dl class="simple">
<dt><strong>Advantages</strong></dt><dd><ul>
<li><p>full C library can be linked in, and the driver can do tasks without using external
programs</p></li>
<li><p>can debug without going through a running kernel</p></li>
<li><p>user-space driver error will not harm the entire system, and can be stopped if it
hangs</p></li>
<li><p>since user memory is swappable, the driver will not occupy RAM if it is not in use</p></li>
<li><p>well-designed user-space driver can allow concurrent access to a device</p></li>
<li><p>easier to write a closed-source user-space driver</p></li>
<li><p>user-space driver usually implements a server process, and client applications can
connect to it to perform actual communication with the device, e.g. X server</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Disadvantages</strong></dt><dd><ul>
<li><p>no interrupts, most system calls are limited to privileged user</p></li>
<li><p>direct memory access is only by mmapping <code class="docutils literal notranslate"><span class="pre">/dev/mem</span></code></p></li>
<li><p>I/O ports access is only after calling <code class="docutils literal notranslate"><span class="pre">ioperm</span></code> or <code class="docutils literal notranslate"><span class="pre">iopl</span></code>, which not all platforms
support, and access to <code class="docutils literal notranslate"><span class="pre">/dev/port</span></code> can be slow</p></li>
<li><p>context switch makes response time slower, and swap makes it worse</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="scull-driver">
<h3>scull Driver<a class="headerlink" href="#scull-driver" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Simple Character Utility for Loading Localities, char driver in LDD 3rd Edition</p></li>
<li><p>acts on a memory area as though it were a device, hardware independent and portable</p></li>
<li><p>global memory area: data within the device is shared by all file descriptors that
opened it</p></li>
<li><p>persistent memory area: data is not lost if the device is closed and reopened</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scullX</span></code> devices contains global and persistent memory area</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scullpipeX</span></code> are FIFO devices</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scullsingle</span></code> allows only one process at a time to use</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scullpriv</span></code> is private to each virtual console</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sculluid</span></code> and <code class="docutils literal notranslate"><span class="pre">scullwuid</span></code> can be opened multiple times, but only one user at a time</p></li>
</ul>
</div></blockquote>
</section>
<section id="udev">
<h3>Udev<a class="headerlink" href="#udev" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>drivers compiled into the kernel register objects in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code>, and modules register when
they are loaded</p></li>
<li><p>when <code class="docutils literal notranslate"><span class="pre">sysfs</span></code> is mounted on <code class="docutils literal notranslate"><span class="pre">/sys</span></code>, data registered is available to userspace processes
and <cite>udevd</cite></p></li>
<li><p>when a device is plugged in, kernel generates a uevent for <code class="docutils literal notranslate"><span class="pre">udevd</span></code> to handle</p></li>
<li><dl class="simple">
<dt><strong>Device Nodes</strong></dt><dd><ul>
<li><p>drivers need to use <code class="docutils literal notranslate"><span class="pre">devtmpfs</span></code> to register a device node</p></li>
<li><p>when <code class="docutils literal notranslate"><span class="pre">devtmpfs</span></code> is mounted on <code class="docutils literal notranslate"><span class="pre">/dev</span></code>, device node is exposed to userspace with a
fixed name, permissions and owner</p></li>
<li><p>when <code class="docutils literal notranslate"><span class="pre">udevd</span></code> receives a uevent from the kernel, it will create additional sysmlinks
to the device node, change permissions, owner, group, or modify internal <code class="docutils literal notranslate"><span class="pre">udevd</span></code>
database entry based on rules</p></li>
<li><p>udev rules are defined in <code class="docutils literal notranslate"><span class="pre">/etc/udev/rules.d</span></code>, <code class="docutils literal notranslate"><span class="pre">/usr/lib/udev/rules.d</span></code>, and
<code class="docutils literal notranslate"><span class="pre">/run/udev/rules.d</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Module Aliases</strong></dt><dd><ul>
<li><p>usually related to bus-specific IDs of devices supported by a module</p></li>
<li><p>can use <code class="docutils literal notranslate"><span class="pre">modinfo</span></code> to check, e.g. <code class="docutils literal notranslate"><span class="pre">snd-fm801</span></code> driver supports PCI devices with vendor
ID 0x1319 and device ID 0x0801</p></li>
<li><p>the bus driver exports the alias of the driver that would handle the device via
<code class="docutils literal notranslate"><span class="pre">sysfs</span></code></p></li>
<li><p>with default rules, <code class="docutils literal notranslate"><span class="pre">udevd</span></code> call out <code class="docutils literal notranslate"><span class="pre">modprobe</span></code> with <code class="docutils literal notranslate"><span class="pre">MODALIAS</span></code> uevent environment
variable, and all modules whose aliases match the string after wildcard expansion
are loaded</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Wrapper Modules</strong></dt><dd><ul>
<li><p>Udev is not intended to load wrapper drivers such as <code class="docutils literal notranslate"><span class="pre">snd-pcm-oss</span></code>, and non-hardware
drivers such as <code class="docutils literal notranslate"><span class="pre">loop</span></code></p></li>
<li><p>configure <code class="docutils literal notranslate"><span class="pre">modprobe</span></code> to load the wrapper after udev loads the wrapped module, e.g.
add <code class="docutils literal notranslate"><span class="pre">softdep</span> <span class="pre">snd-pcm</span> <span class="pre">post:</span> <span class="pre">snd-pcm-oss</span></code> in <code class="docutils literal notranslate"><span class="pre">/etc/mobprobe.d/&lt;file&gt;.conf</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Unwanted Modules</strong></dt><dd><ul>
<li><p>do not bind the module, or blacklist in <code class="docutils literal notranslate"><span class="pre">/etc/modprobe.d/blacklist.conf</span></code></p></li>
<li><p>blacklisted modules can be loaded manually with explicit <code class="docutils literal notranslate"><span class="pre">modprobe</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p><a class="reference external" href="#linux">back to top</a></p>
</section>
</section>
<section id="linux-from-scratch">
<h2>Linux From Scratch<a class="headerlink" href="#linux-from-scratch" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#lfs-preparations">LFS Preparations</a>, <a class="reference internal" href="#lfs-building">LFS Building</a>, <a class="reference internal" href="#lfs-directories">LFS Directories</a>, <a class="reference internal" href="#lfs-backup-and-restore">LFS Backup and Restore</a></p></li>
<li><p><a class="reference internal" href="#lfs-debugging-symbols">LFS Debugging Symbols</a>, <a class="reference internal" href="#lfs-udev-issues">LFS Udev Issues</a></p></li>
<li><p>this section is mostly from following along the Linux From Scratch book</p></li>
</ul>
<section id="lfs-preparations">
<h3>LFS Preparations<a class="headerlink" href="#lfs-preparations" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><strong>Partitioning</strong></dt><dd><ul>
<li><p>use 10GB partition for minimal system, or 30GB for further enhancements</p></li>
<li><p>to create unallocated space from allocated free space, booting into live Linux and
resizing with parted or gparted can be easy</p></li>
<li><p>use fdisk or cfdisk to create a partition from the unallocated free space</p></li>
<li><p>create a file system with <code class="docutils literal notranslate"><span class="pre">mkfs</span> <span class="pre">-v</span> <span class="pre">-t</span> <span class="pre">ext4</span> <span class="pre">/dev/&lt;name&gt;</span></code></p></li>
<li><p>for the host system to access, mount the partition to the directory where LFS system
will be built</p></li>
<li><p>the partition must be mounted on every host system restart, or edit <code class="docutils literal notranslate"><span class="pre">/etc/fstab</span></code> to
auto mount</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Download Files</strong></dt><dd><ul>
<li><p>required files can be found at <a class="reference external" href="https://www.linuxfromscratch.org/mirrors.html#files">https://www.linuxfromscratch.org/mirrors.html#files</a></p></li>
<li><p>store the files in the directory where LFS partition is mounted</p></li>
<li><p>file ownership may need to be modified with <code class="docutils literal notranslate"><span class="pre">chown</span> <span class="pre">root:root</span> <span class="pre">/LFS/dir/files/*</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Directories</strong></dt><dd><ul>
<li><p>create <code class="docutils literal notranslate"><span class="pre">etc</span></code>, <code class="docutils literal notranslate"><span class="pre">var</span></code>, <code class="docutils literal notranslate"><span class="pre">usr/bin</span></code>, <code class="docutils literal notranslate"><span class="pre">usr/lib</span></code>, <code class="docutils literal notranslate"><span class="pre">usr/sbin</span></code>, along with symlinks of <code class="docutils literal notranslate"><span class="pre">usr/*</span></code>
in root directory of LFS system</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>lfs User</strong></dt><dd><ul>
<li><p>create group and user named <code class="docutils literal notranslate"><span class="pre">lfs</span></code> with <code class="docutils literal notranslate"><span class="pre">groupadd</span></code> and <code class="docutils literal notranslate"><span class="pre">useradd</span></code>, and set password
with <code class="docutils literal notranslate"><span class="pre">passwd</span> <span class="pre">lfs</span></code></p></li>
<li><p>change ownership of files in LFS system directory to <code class="docutils literal notranslate"><span class="pre">lfs</span></code> user</p></li>
<li><p>can start a shell of <code class="docutils literal notranslate"><span class="pre">lfs</span></code> user with <code class="docutils literal notranslate"><span class="pre">su</span> <span class="pre">-</span> <span class="pre">lfs</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Environment Setup for lfs User</strong></dt><dd><ul>
<li><p>create <code class="docutils literal notranslate"><span class="pre">.bash_profile</span></code> with <code class="docutils literal notranslate"><span class="pre">exec</span> <span class="pre">env</span> <span class="pre">-i</span> <span class="pre">HOME=$HOME</span> <span class="pre">TERM=$TERM</span> <span class="pre">/bin/bash</span></code> to set
empty environment</p></li>
<li><p>create <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> with following commands:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">+h</span></code>: turns off bash hash function to search <code class="docutils literal notranslate"><span class="pre">PATH</span></code> on every program run and use
newly compiled tools</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">umask</span> <span class="pre">022</span></code>: set user file-creation mask to make newly files and directories are
only writable by their owner, but readable and executable by anyone</p></li>
<li><p>set env variable of <code class="docutils literal notranslate"><span class="pre">LFS=original_mount_point</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LC_ALL=POSIX</span></code> to control localisation of certain programs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LFS_TGT=$(uname</span> <span class="pre">-m)-lfs-linux-gnu</span></code> for non-default machine description</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PATH=/usr/bin</span></code> and <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">[</span> <span class="pre">!</span> <span class="pre">-L</span> <span class="pre">/bin</span> <span class="pre">];</span> <span class="pre">then</span> <span class="pre">PATH=/bin:$PATH;</span> <span class="pre">fi</span></code> to add <code class="docutils literal notranslate"><span class="pre">/bin</span></code> to
<code class="docutils literal notranslate"><span class="pre">PATH</span></code> if it is not symlinked</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PATH=$LFS/tools/bin:$PATH</span></code> to use the new cross-compiler</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_SITE=$LFS/user/share/config.site</span></code> to prevent configure scripts loading
configurations from the host</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MAKEFLAGS=-j$(nproc)</span></code> to let <code class="docutils literal notranslate"><span class="pre">make</span></code> use all cores for faster build jobs</p></li>
<li><p>env variables need to be exported using <code class="docutils literal notranslate"><span class="pre">export</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="lfs-building">
<h3>LFS Building<a class="headerlink" href="#lfs-building" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>offset or fuzzy warning messages when applying a patch can be ignored</p></li>
<li><dl class="simple">
<dt><strong>Autoconf Build System</strong></dt><dd><ul>
<li><p>accepts system types in a triplet, cpu-vendor-kernel-os, where vendor field can be
omitted, e.g. x86_64-redhat-linux</p></li>
<li><p>two systems can share the same kernel and be different to use the same triplet to
describe them, e.g. Android and Ubuntu on ARM64 using the same Linux kernel</p></li>
<li><p>can check system triplet with <code class="docutils literal notranslate"><span class="pre">config.guess</span></code> script from source files, or
<code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">-dumpmachine</span></code></p></li>
<li><p>can check the dynamic linker with <code class="docutils literal notranslate"><span class="pre">readelf</span> <span class="pre">-l</span> <span class="pre">any_binary</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">interpreter</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>install the cross-toolchain under <code class="docutils literal notranslate"><span class="pre">$LFS/tools</span></code> be keep them separate</p></li>
</ul>
</div></blockquote>
</section>
<section id="lfs-directories">
<h3>LFS Directories<a class="headerlink" href="#lfs-directories" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul>
<li><p>enter a chroot environment to install the final LFS system</p></li>
<li><dl class="simple">
<dt><strong>Virtual Kernel File Systems</strong></dt><dd><ul class="simple">
<li><p>created by the kernel, and used by applications to communicated with it</p></li>
<li><p>virtual file systems, and no disk space is used as contents are in memory</p></li>
<li><p>mount the necessary in LFS directory tree, such as <code class="docutils literal notranslate"><span class="pre">dev</span></code>, <code class="docutils literal notranslate"><span class="pre">proc</span></code>, <code class="docutils literal notranslate"><span class="pre">sys</span></code>, <code class="docutils literal notranslate"><span class="pre">run</span></code></p></li>
<li><p>kernel auto mounts <code class="docutils literal notranslate"><span class="pre">devtmpfs</span></code> on <code class="docutils literal notranslate"><span class="pre">/dev</span></code> and create device device nodes</p></li>
<li><p>some hosts can be without <code class="docutils literal notranslate"><span class="pre">devtmpfs</span></code> support, and need to bind mount the host’s
<code class="docutils literal notranslate"><span class="pre">/dev</span></code> with <code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-v</span> <span class="pre">--bind</span> <span class="pre">/dev</span> <span class="pre">$LFS/dev</span></code></p></li>
<li><p>mount others with <code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-vt</span> <span class="pre">devpts</span> <span class="pre">devpts</span> <span class="pre">-o</span> <span class="pre">gid=5,mode=0620</span> <span class="pre">$LFS/dev/pts</span></code>,
<code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-vt</span> <span class="pre">proc</span> <span class="pre">proc</span> <span class="pre">$LFS/proc</span></code>, <code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-vt</span> <span class="pre">sysfs</span> <span class="pre">sysfs</span> <span class="pre">$LFS/sys</span></code>,
<code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-vt</span> <span class="pre">tmpfs</span> <span class="pre">tmpfs</span> <span class="pre">$LFS/run</span></code></p></li>
<li><p>may need to explicitly mount a tmpfs with
<code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-vt</span> <span class="pre">tmpfs</span> <span class="pre">-o</span> <span class="pre">nosuid,nodev</span> <span class="pre">tmpfs</span> <span class="pre">$LFS/dev/shm</span></code></p></li>
<li><p>can check VFS mounts with <code class="docutils literal notranslate"><span class="pre">findmnt</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">$LFS</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>Entering Chroot</strong></p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chroot<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LFS</span><span class="s2">&quot;</span><span class="w"> </span>/usr/bin/env<span class="w"> </span>-i<span class="w"> </span><span class="se">\</span>
<span class="nv">HOME</span><span class="o">=</span>/root<span class="w"> </span><span class="se">\</span>
<span class="nv">TERM</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TERM</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="nv">PS1</span><span class="o">=</span><span class="s1">&#39;(lfs chroot) \u:\w\$ &#39;</span><span class="w"> </span><span class="se">\</span>
<span class="nv">PATH</span><span class="o">=</span>/usr/bin:/usr/sbin<span class="w"> </span><span class="se">\</span>
<span class="nv">MAKEFLAGS</span><span class="o">=</span><span class="s2">&quot;-j</span><span class="k">$(</span>nproc<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="nv">TESTSUITEFLAGS</span><span class="o">=</span><span class="s2">&quot;-j</span><span class="k">$(</span>nproc<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
/bin/bash<span class="w"> </span>--login
</pre></div>
</div>
</div></blockquote>
</li>
<li><dl class="simple">
<dt><strong>Full Directory Structure</strong></dt><dd><ul class="simple">
<li><p>create root-level directories with <code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-pv</span> <span class="pre">/{boot,home,mnt,opt,srv}</span></code></p></li>
<li><p>create subdirectories <code class="docutils literal notranslate"><span class="pre">/etc/{opt,sysconfig}</span></code>, <code class="docutils literal notranslate"><span class="pre">/lib/firmware</span></code>,
<code class="docutils literal notranslate"><span class="pre">/media/{floppy,cdrom}</span></code>, <code class="docutils literal notranslate"><span class="pre">/usr/{,local/}{include,src}</span></code>, <code class="docutils literal notranslate"><span class="pre">/usr/lib/locale</span></code>,
<code class="docutils literal notranslate"><span class="pre">/usr/local/{bin,lib,sbin}</span></code>, <code class="docutils literal notranslate"><span class="pre">/usr/{,local/}share/{color,dict,doc,info,locale,man}</span></code>,
<code class="docutils literal notranslate"><span class="pre">/usr/{,local/}share/{misc,terminfo,zoneinfo}</span></code>, <code class="docutils literal notranslate"><span class="pre">/usr/{,local/}share/man/man{1..8}</span></code>,
<code class="docutils literal notranslate"><span class="pre">/var/{cache,local,log,mail,opt,spool}</span></code>, <code class="docutils literal notranslate"><span class="pre">/var/lib/{color,misc,locate}</span></code></p></li>
<li><p>create symlinks with <code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-sfv</span> <span class="pre">/run</span> <span class="pre">/var/run</span></code>, <code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-sfv</span> <span class="pre">/run/lock</span> <span class="pre">/var/lock</span></code>,
<code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-sv</span> <span class="pre">/proc/self/mounts</span> <span class="pre">/etc/mtab</span></code></p></li>
<li><p>set attributes with <code class="docutils literal notranslate"><span class="pre">install</span> <span class="pre">-dv</span> <span class="pre">-m</span> <span class="pre">0750</span> <span class="pre">/root</span></code>, <code class="docutils literal notranslate"><span class="pre">install</span> <span class="pre">-dv</span> <span class="pre">-m</span> <span class="pre">1777</span> <span class="pre">/tmp</span> <span class="pre">/var/tmp</span></code></p></li>
<li><p>create log files with <code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">/var/log/{btmp,lastlog,faillog,wtmp}</span></code>,
<code class="docutils literal notranslate"><span class="pre">chgrp</span> <span class="pre">-v</span> <span class="pre">utmp</span> <span class="pre">/var/log/lastlog</span></code>, <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">-v</span> <span class="pre">664</span> <span class="pre">/var/log/lastlog</span></code>,
<code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">-v</span> <span class="pre">600</span> <span class="pre">/var/log/btmp</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>/etc/hosts File</strong></p>
<blockquote>
<div><p>127.0.0.1 localhost $(hostname)
::1       localhost</p>
</div></blockquote>
</li>
<li><p><strong>/etc/passwd File</strong></p>
<blockquote>
<div><p>root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/dev/null:/usr/bin/false
daemon:x:6:6:Daemon User:/dev/null:/usr/bin/false
messagebus:x:18:18:D-Bus Message Daemon User:/run/dbus:/usr/bin/false
uuidd:x:80:80:UUID Generation Daemon User:/dev/null:/usr/bin/false
nobody:x:65534:65534:Unprivileged User:/dev/null:/usr/bin/false</p>
</div></blockquote>
</li>
<li><dl>
<dt><strong>/etc/group File</strong></dt><dd><ul class="simple">
<li><p>LSB only recommends GID 0 <code class="docutils literal notranslate"><span class="pre">root</span></code> and GID 1 <code class="docutils literal notranslate"><span class="pre">bin</span></code></p></li>
<li><p>GID 5 is widely used for <code class="docutils literal notranslate"><span class="pre">tty</span></code> group, and other names and GID can be chosen freely</p></li>
<li><p>well-written programs do not depend on GID numbers, but the name</p></li>
</ul>
<p>root:x:0:
bin:x:1:daemon
sys:x:2:
kmem:x:3:
tape:x:4:
tty:x:5:
daemon:x:6:
floppy:x:7:
disk:x:8:
lp:x:9:
dialout:x:10:
audio:x:11:
video:x:12:
utmp:x:13:
cdrom:x:15:
adm:x:16:
messagebus:x:18:
input:x:24:
mail:x:34:
kvm:x:61:
uuidd:x:80:
wheel:x:97:
users:x:999:
nogroup:x:65534:</p>
</dd>
</dl>
</li>
<li><p>set locale with <code class="docutils literal notranslate"><span class="pre">localedef</span> <span class="pre">-i</span> <span class="pre">C</span> <span class="pre">-f</span> <span class="pre">UTF-8</span> <span class="pre">C.UTF-8</span></code></p></li>
<li><p>can add a temporary user to run tests with
<code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;tester:x:101:101::/home/tester:/bin/bash&quot;</span> <span class="pre">&gt;&gt;</span> <span class="pre">/etc/passwd</span></code>,
<code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;tester:x:101:&quot;</span> <span class="pre">&gt;&gt;</span> <span class="pre">/etc/group</span></code>, and <code class="docutils literal notranslate"><span class="pre">install</span> <span class="pre">-o</span> <span class="pre">tester</span> <span class="pre">-d</span> <span class="pre">/home/tester</span></code></p></li>
</ul>
</div></blockquote>
</section>
<section id="lfs-backup-and-restore">
<h3>LFS Backup and Restore<a class="headerlink" href="#lfs-backup-and-restore" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>after creating essential programs and libraries, LFS system should be backed up in case
of failures in the future</p></li>
<li><p>create a backup outside the chroot environment</p></li>
<li><p>does not need to unmount the LFS root directory</p></li>
<li><p>umount VFS with <code class="docutils literal notranslate"><span class="pre">mountpoint</span> <span class="pre">-q</span> <span class="pre">$LFS/dev/shm</span> <span class="pre">&amp;&amp;</span> <span class="pre">umount</span> <span class="pre">$LFS/dev/shm</span></code>,
<code class="docutils literal notranslate"><span class="pre">umount</span> <span class="pre">$LFS/dev/pts</span></code>, <code class="docutils literal notranslate"><span class="pre">umount</span> <span class="pre">$LFS/{sys,proc,run,dev}</span></code></p></li>
<li><p>create a backup archive with <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">-cJpf</span> <span class="pre">lfs-temp-tools.12.2.tar.xz</span> <span class="pre">-C</span> <span class="pre">$LFS</span> <span class="pre">.</span></code></p></li>
<li><p>restore with <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">$LFS/*</span></code>, and <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">-xvpf</span> <span class="pre">lfs-temp-tools.12.2.tar.xz</span> <span class="pre">-C</span> <span class="pre">$LFS/</span></code></p></li>
</ul>
</div></blockquote>
</section>
<section id="lfs-debugging-symbols">
<h3>LFS Debugging Symbols<a class="headerlink" href="#lfs-debugging-symbols" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>programs and libraries compiled with debugging symbols, <code class="docutils literal notranslate"><span class="pre">gcc</span> <span class="pre">-g</span></code> option, enlarge
significantly</p></li>
<li><p>sizes vary depending on compiler and C library, but program without debugging symbols is
usually 50% to 80% smaller</p></li>
<li><dl class="simple">
<dt><strong>Strip</strong></dt><dd><ul>
<li><p>use with <code class="docutils literal notranslate"><span class="pre">--strip-unneeded</span></code> to remove all debug symbols from binary or library</p></li>
<li><p>always make a backup before running <code class="docutils literal notranslate"><span class="pre">strip</span></code> commands</p></li>
<li><p>symbols will be compressed with Zlib in separate files, which can be used to run
regression tests with <code class="docutils literal notranslate"><span class="pre">valgrind</span></code> or <code class="docutils literal notranslate"><span class="pre">gdb</span></code></p></li>
<li><p>the processed binary or library will be overwritten, and can cause crashes</p></li>
<li><p>it is better to make copies, strip them, and reinstall with <code class="docutils literal notranslate"><span class="pre">install</span></code> command</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="lfs-udev-issues">
<h3>LFS Udev Issues<a class="headerlink" href="#lfs-udev-issues" title="Link to this heading">#</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>use <code class="docutils literal notranslate"><span class="pre">udevadm</span> <span class="pre">info</span></code> to find and fix offending udev rules</p></li>
<li><p>for kernel timing issues, create a rule to wait for the used <code class="docutils literal notranslate"><span class="pre">sysfs</span></code> attribute and
append it to the <cite>/etc/udev/rules.d/10-wait_for_sysfs.rules</cite></p></li>
<li><p>if udev does not create a device, create a static device node in <code class="docutils literal notranslate"><span class="pre">/usr/lib/udev/devices</span></code>
with appropriate major/minor numbers</p></li>
<li><p>it is better to create own rules that make symlinks with stable names based on stable
attributes of the device, e.g. serial number or output of various <cite>*_id</cite> utilities</p></li>
</ul>
</div></blockquote>
<p><a class="reference external" href="#linux">back to top</a></p>
</section>
</section>
<section id="references-external-resources">
<h2>References &amp; External Resources<a class="headerlink" href="#references-external-resources" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Corbet, J., Rubini A., Kroah-Hartman, G. (2005). Linux Device Drivers, Third Edition.
Sebastopol, CA: O’Reilly Media, Inc.</p></li>
<li><p>Kroah-Hartman, G. (2007). Linux Kernel in a Nutshell. Sebastopol, CA: O’Reilly Media, Inc.</p></li>
<li><p>Beekmans, G. (2024). Linux From Scratch [online]. Available at:
<a class="reference external" href="https://www.linuxfromscratch.org/lfs/">https://www.linuxfromscratch.org/lfs/</a></p></li>
<li><p>The Linux Foundation. (2024). LF Live: Mentorship Series. Available at:
<a class="reference external" href="https://events.linuxfoundation.org/lf-live-mentorship-series/">https://events.linuxfoundation.org/lf-live-mentorship-series/</a></p></li>
<li><p>The Linux Foundation. (2024). LFX Mentorship. Available at:
<a class="reference external" href="https://lfx.linuxfoundation.org/tools/mentorship/">https://lfx.linuxfoundation.org/tools/mentorship/</a></p></li>
<li><p>The Linux Foundation. (2017). Introduction to Memory Management in Linux - Matt Porter,
Konsulko. Available at: <a class="reference external" href="https://youtu.be/7aONIVSXiJ8?si=4lVDrJKYy9vn6QNM">https://youtu.be/7aONIVSXiJ8?si=4lVDrJKYy9vn6QNM</a></p></li>
<li><p>The Linux Foundation. (2017). Getting Into Linux Kernel Development After 30 Years - Muhammad
Usama Anjum, Collabora. Available at: <a class="reference external" href="https://youtu.be/xtXn45cnVzE?si=w9TIYBbfNBiWlqwL">https://youtu.be/xtXn45cnVzE?si=w9TIYBbfNBiWlqwL</a></p></li>
<li><p>Mochel, P. (2005). The sysfs Filesystem [online]. Available at:
<a class="reference external" href="https://www.kernel.org/doc/ols/2005/ols2005v1-pages-321-334.pdf">https://www.kernel.org/doc/ols/2005/ols2005v1-pages-321-334.pdf</a></p></li>
<li><p>Kroah-Hartman, G. (2003). udev - A Userspace Implementation of devfs [online]. Available at:
<a class="reference external" href="https://www.kernel.org/doc/ols/2003/ols2003-pages-249-257.pdf">https://www.kernel.org/doc/ols/2003/ols2003-pages-249-257.pdf</a></p></li>
</ul>
<p><a class="reference external" href="#linux">back to top</a></p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="LangChain.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">LangChain</p>
      </div>
    </a>
    <a class="right-next"
       href="MachineLearning.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Machine Learning</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#commands">Commands</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#file-directory">File &amp; Directory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#links">Links</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-find">Search &amp; Find</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#input-output">Input/Output</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#processes">Processes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#man">Man</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reboot-shutdown">Reboot &amp; Shutdown</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boot-targets">Boot Targets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootloader">Bootloader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#init-systems">Init Systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#schedule-jobs">Schedule Jobs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#package-manager">Package Manager</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bash-scripts">Bash Scripts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selinux">SELinux</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-runtime-parameters">Kernel Runtime Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#users">Users</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#groups">Groups</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-variables">Environment Variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resource-limits">Resource Limits</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#privileges">Privileges</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acls">ACLs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#network-management">Network Management</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#firewall">Firewall</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#static-routing">Static Routing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-synchronisation">Time Synchronisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bind">Bind</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#email">Email</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ssh">SSH</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#http">HTTP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#database-server">Database Server</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#devices-disks">Devices &amp; Disks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-file-systems">Creating File Systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lvm">LVM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#device-encryption">Device Encryption</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raid">RAID</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-management">Memory Management</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#virtual-memory">Virtual Memory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-management-unit">Memory Management Unit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-virtual-memory">Kernel Virtual Memory</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-logical-addresses">Kernel Logical Addresses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-virtual-addresses">Kernel Virtual Addresses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#user-virtual-addresses">User Virtual Addresses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#user-space-allocation">User-Space Allocation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-development">Kernel Development</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-tools">Build Tools</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-dependent-tools">Kernel Dependent Tools</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-config">Kernel Config</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-kernel">Build Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#install-kernel">Install Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upgrade-kernel">Upgrade Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customise-kernel">Customise Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-drivers">Find Drivers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#common-config">Common Config</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#code-navigation">Code Navigation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pie">PIE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ffi">FFI</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-data-structures">Kernel Data Structures</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#file-operations">File Operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inode">Inode</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-modules">Kernel Modules</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-role">Kernel Role</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#device-and-module-classes">Device and Module Classes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#protection-levels">Protection Levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#current-process">Current Process</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compile-and-load-modules">Compile and Load Modules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-stacking">Module Stacking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-conventions">Module Conventions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-functions">Module Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#module-parameters">Module Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pam">PAM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#device-drivers">Device Drivers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#driver-components">Driver Components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#user-space-drivers">User-Space Drivers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scull-driver">scull Driver</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#udev">Udev</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linux-from-scratch">Linux From Scratch</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-preparations">LFS Preparations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-building">LFS Building</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-directories">LFS Directories</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-backup-and-restore">LFS Backup and Restore</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-debugging-symbols">LFS Debugging Symbols</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lfs-udev-issues">LFS Udev Issues</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-external-resources">References &amp; External Resources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Myat Kyaw Tun
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Myat Kyaw Tun.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>